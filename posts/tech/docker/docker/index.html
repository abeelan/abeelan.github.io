<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker - 了解与基本使用 | ABEE</title><meta name=keywords content="docker"><meta name=description content="Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。 介绍 优点 快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期； 复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发"><meta name=author content="ABEE"><link rel=canonical href=https://abeelan.github.io/posts/tech/docker/docker/><link crossorigin=anonymous href=/assets/css/stylesheet.fbe782675a7c7c9c739a48204d6d2a4da78a00e11ba93326b39891e3501b1740.css integrity="sha256-++eCZ1p8fJxzmkggTW0qTaeKAOEbqTMms5iR41AbF0A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://abeelan.github.io/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abeelan.github.io/img/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://abeelan.github.io/img/favicon.ico><link rel=apple-touch-icon href=https://abeelan.github.io/img/favicon.ico><link rel=mask-icon href=https://abeelan.github.io/img/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><meta property="og:title" content="Docker - 了解与基本使用"><meta property="og:description" content="Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。 介绍 优点 快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期； 复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发"><meta property="og:type" content="article"><meta property="og:url" content="https://abeelan.github.io/posts/tech/docker/docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-24T14:26:21+08:00"><meta property="article:modified_time" content="2021-08-24T14:26:21+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker - 了解与基本使用"><meta name=twitter:description content="Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。 介绍 优点 快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期； 复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚 分类","item":"https://abeelan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"👨🏻‍💻 技术","item":"https://abeelan.github.io/posts/tech/"},{"@type":"ListItem","position":3,"name":"Docker - 了解与基本使用","item":"https://abeelan.github.io/posts/tech/docker/docker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker - 了解与基本使用","name":"Docker - 了解与基本使用","description":"Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。 介绍 优点 快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期； 复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发","keywords":["docker"],"articleBody":"Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。\n介绍 优点  快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期； 复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发环境、测试环境、线上环境一致； 轻量级。对于系统内核来说，一个 docker 只是一个进程，一个系统可以运行上千个容器。  与虚拟机的区别  容器与容器之间只是进程隔离，而虚拟机是完全的资源隔离； 虚拟机的启动需要分钟级别，Docker 启动是秒级或者更短； 容器共享宿主操作系统的内核，减少内核的开销；而虚拟机使用完全独立的内核。  Docker 架构 概念 https://zh.wikipedia.org/wiki/Docker\n**Docker 镜像（Docker Images）**每一个镜像都可能依赖一个或者多个下层的镜像组成的另一个镜像，AUFS 文件系统；\n**Docker 仓库（Docker Registry）**集中存放镜像的地方；\n**Docker 容器（Docker Containers）**镜像运行后的进程。\n安装与配置 官网下载 Desktop：https://www.docker.com/products/docker-desktop\n命令 # CentOS 启动 docker 服务 $ systemctl start docker $ systemctl restart docker $ ststemctl enable docker # 开机自启动 # ubantu 自动启动 # MacOS 和 Windows 通过桌面版启动 基本命令 # 查看版本信息 $ docker version # 查看系统信息 $ dcoker info 镜像管理 # 查看所有镜像 $ docker images # 搜索镜像 $ docker search jenkins # 拉取镜像，默认最新版本，可以指定版本 $ docker pull jenkins:latest # 导出镜像 $ docker save jenkins:latest  jenkins.tar # 导出镜像 $ docker load # 删除镜像 $ docker rmi jenkins:latest # 修改镜像标签名 $ docker tag jenkins:latest jenkins:test # 查看镜像创建历史 $ docker history jenkins 容器管理 # 运行容器；-d 在后台运行 $ docker run -d --name=mysql:latest # 查看运行中的容器 $ docker ps $ docker ps -a # 查看容器中运行的进程 $ docker top mysql # 查看资源占用 $ docker stats mysql # 容器操作 $ docker start/restart/stop/kill mysql # 暂停容器 $ docker pause/unpause mysql # 强制删除容器 $ docker rm -f mysql # 查看容器运行日志 $ docker logs -f {CONTAINER_ID} # 执行命令(-i 交互式 -t 终端方式) $ docker exec -it mysql bash # 复制文件 $ docker cp mysql:/var/tmp . $ docker cp a.txt mysql:/tmp # 查看容器/镜像元信息 $ docker insepct mysql $ docker inspect -f '{{.Created}}' mysql # 格式化输出提取 # 查看容器内文件结构变化 $ docker diff mysql # 查看容器原信息；包含 PID、IP 等等 $ docker inspect mysql 容器启动参数解释 端口映射（-p） docker 会在虚拟的容器网络内启动容器，容器网络内的容器之间可以互相通信，外部无法与容器进行通信，我们希望将宿主机（启动容器的机器）作为跳板，这样，用户可以将网络请求发送给宿主机，宿主机再转发请求到容器实现通信，所以需要端口映射。\n$ docker run --name=hub -p 5001:4444 用户将请求发送到宿主机的 5001 端口，宿主机再转发请求到容器的 4444 端口。\n使用宿主机网络（–net host） 通过 –net 指定 host 就可以不用容器网络，直接使用宿主机的网络。\n容器间网络互通（–net container:容器名） 容器 A 使用容器 B 的网络；容器 ABCD 使用容器 E 的网络\n环境变量（-e） 启动容器时，通过设置环境变量，来控制容器行为。容器内部的程序会读取环境变量，相当于传参。\n比如，通过 mysql 镜像启动容器，不知道用户想设置什么账号密码，那么就通过环境变量来进行设置。\n后台执行（-d） 如果非后台执行的话，关闭当前窗口或者 ctrl+c 结束命令后，该容器就会停止运行，服务停掉。\n搭建 Web 服务器 Nginx Nginx 简介 Nginx（发音同 engine x）是一个异步的 Web 服务器，主要提供 Web 服务、反向代理、负载均衡和 HTTP 缓存功能。由 Igor Sysoev 创建于 2004 年，使用 C 语言开发。\n反向代理：服务器将收到的请求分发到其他服务器\n负载均衡：流量均匀的分布到后端的服务器上\nHTTP缓存：缓存服务器，提高用户访问速度\n运行 Nginx 容器 # 拉取 $ docker pull nginx:1.17.9 # 运行 # 将容器的 80 端口映射到本机的 80 端口，浏览器访问本机 IP 即可看到 nginx 欢迎页 # 退出后就不能访问了 $ docker run -p 80:80 nginx:1.17.9 # -d 在后台运行 $ docker run -d --name nginx -p 80:80 nginx 6438442df9b325e8bfc5a8c5ff95dc21e599c0e885a7dbf5687d91c1f44045db # -v 挂载目录，在本地的html目录下添加文件，访问服务的 8080 端口就可以看到了 $ docker run -d --name nginx -p 8080:80 -v ${PWD}/nginx/html:/usr/share/nginx/html nginx:1.17.9 891e09a6bbb5e131f99cd3fe60dfb2687b0939c28ad614d017408ce74478b1a1 $ cd nginx/html $ vi index.html Everythin will be ok. # 保存后，访问本地服务的8080端口，即可看到页面展示 搭建测试用例管理平台 Testlink Testlink 简介 Testlink 基于 WEB 的测试用例管理系统，主要功能是测试项目管理、产品需求管理、测试用例管理、测试计划管理、测试用例的创建、管理和执行，并且还提供了统计功能。\n部署数据库 # 创建一个名为 testlink 的容器网络 $ docker network create testlink # 查看当前存在的容器网络 $ docker network ls NETWORK ID NAME DRIVER SCOPE 备注（自己加的） 4deb334c55f6 bridge bridge local 桥接网络 cf4fbaac0160 host host local 主机网络 50027393c74d none null local 6ac9853f1eab testlink bridge local 刚才新建的网络 # 运行数据库，如果本地没有该镜像的话会自动去下载 $ docker run -d --name mariadb -e MARIADB_ROOT_PASSWORD=mariadb -e MARIADB_USER=bn_testlink -e MARIADB_PASSWORD=bn_testlink -e MARIADB_DATABASE=bitnami_testlink --net testlink -v ${PWD}/mariadb:/bitnami bitnami/mariadb:10.3.22 Unable to find image 'bitnami/mariadb:10.3.22' locally 10.3.22: Pulling from bitnami/mariadb ... 74dbf92d3ddca4d241f2b9022890445820f7e26e5324c352c90983515379bd65 部署 Testlink # 运行 testlink $ docker run -d -p 80:8080 -p 443:8443 --name testlink -e TESTLINK_DATABASE_USER=bn_testlink -e TESTLINK_DATABASE_PASSWORD=bn_testlink -e TESTLINK_DATABASE_NAME=bitnami_testlink --net testlink -v ${PWD}/testlink:/bitnami bitnami/testlink:1.9.20 Unable to find image 'bitnami/testlink:1.9.20' locally 1.9.20: Pulling from bitnami/testlink ... 5e766b7f386db5c0bdb3adcb14c1daea6f5f9517f56dfc9af556fbcb4c6e1bc9 在浏览器访问本地 IP 地址，即可正常浏览网页。\n默认用户名：user；默认密码：bitnami。\n搭建持续集成平台 Jenkins 简介 Jenkins 是开源的 CI\u0026CD 软件领导者，提供持续集成和持续交付服务，有超过 1000 个插件来支持构建、部署、自动化，满足任何项目的需要。\n部署 Jenkins # 运行 $ docker run -d --name jenkins -p 8080:8080 jenkins/jenkins Unable to find image 'jenkins/jenkins:latest' locally latest: Pulling from jenkins/jenkins ... 0f2b01bf74d566fe6ea90790307ccd1de317f1095b1d3056a3986c0eaee8c856 # 首次启动需要管理员密码，通过日志可以查看 $ docker logs -f jenkins ... ************************************************************* Jenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 207e5af52d004e058e48e66c751b5086 This may also be found at: /var/jenkins_home/secrets/initialAdminPassword ************************************************************* # 也可以去文件内查看默认密码 $ docker exec -it jenkins cat /var/jenkins_home/secrets/initialAdminPassword 207e5af52d004e058e48e66c751b5086 # 挂载目录，由于容器名称不能重复，需要删除之前的容器或者更换名字 $ docker run -d --name jenkins -p 8080:8080 -p 50000:50000 -v ${PWD}/jenkins:/var/jenkins_home jenkins/jenkins # 如果启动失败，添加下权限后重启即可 $ chmod 777 jenkins $ docker restart jenkins Dcoekr-compose 简介 Docker-compose 是用于定义和运行多容器的 Docker 应用程序的工具。通过 compose，可以使用 yaml 文件来配置应用程序的服务。compose 的使用一般分为三步：\n 使用 Dockerfile 定义应用程序的环境，以便可以在任何地方复制它； 在 docker-compose.yml 中定义组成应用程序的服务，以便他们可以在隔离的环境中一起运行； 运行 docker-compose up，然后 compose 启动并运行您的整个应用程序。  安装 macOS、windwos 上的 Desktop 版本，默认已经安装\n# 验证 $ docker-compose version docker-compose version 1.23.2, build 1110ad01 docker-py version: 3.6.0 CPython version: 3.6.6 OpenSSL version: OpenSSL 1.1.0h 27 Mar 2018 常用命令 # 查看配置 $ docker-compose config # 后台启动 $ docker-compose up -d # 构建镜像 $ docker-compose build # 下载镜像 $ docker-compose pull # 正在运行 $ docker-compose ps # 进程 $ docker-compose top # 启动 $ docker-compose start # 停止 $ docker-compose stop 演示 通过一个 Python web 小实例来演示 Docker-compose 的功能。\n# docker-compose.yml # 指定 docker-compose API 版本 # 在当前目录下运行 docker-compose config 可以验证变量具体的值 version: '3' services: web: build: context: . depends_on: - redis ports: - \"5000:5000\" redis: image: ${REDIS_VERSION} restart: always # .env REDIS_VERSION=redis:alpine # Dockerfile FROM python:3.7-alpine LABEL maintainer=\"test\" # 工作路径设定为 /code WORKDIR /code # 创建环境变量给 Flask 使用 ENV FLASK_APP app.py ENV FLASK_RUN_HOST 0.0.0.0 # 复制 app.py 到容器内的 /code 目录 COPY app.py /code # 安装 gcc 工具、python 依赖 RUN pip install flask \u0026\u0026 pip install redis # 映射端口 EXPOSE 5000 STOPSIGNAL SIGTERM # 为容器设置默认启动命令 CMD [\"flask\", \"run\"] # app.py # 实现统计访问次数 import time import redis from flask import Flask app = Flask(__name__) cache = redis.Redis(host='redis', port=6379) def get_hit_count(): retries = 5 while True: try: return cache.incr(\"hits\") except redis.exceptions.ConnectionError as e: if retries == 0: raise e retries -= 1 time.sleep(0.5) @app.route('/') def hello(): count = get_hit_count() return f\"Hello World! I have been seen {count} times.\\n\" 启动 $ docker-compoes up -d Docker registry 简介 Docker Registry 是存储 Dcoker Image 的仓库，运行 push、pull、search 时，是通过 Docker daemon 与 docker registry 通信。有时候使用 Docker Hub 这样的公共仓库可能不方便，我们可以通过 registry 创建一个本地仓库。\n运行 # 搭建仓库的主机运行 $ docker run -d -p 5000:5000 -v ${PWD}/registry:/var/lib/registry --restart always --name registry registry:2.7.1 # 其他机配置下镜像仓库 $ vim /etc/docker/daemon.json { \"insecure-registries\":[\"{仓库主机的IP地址和端口号}\"] } $ systemctl restart docker # 重启下docker 演示 # 搭建仓库的主机：先从 docker hub 上随便下载一个镜像 $ docker pull nginx:1.18.0 # 打上带主机 IP 地址的标签 $ docker tag nginx:1.18.0 {仓库地址}/nginx:1.18.0 # 推送到内网仓库下 $ docker push {仓库IP:port}/nginx:1.18.0 # 其他机器 $ docker pull {仓库IP:port}/nginx:1.18.0 # 查看下载的镜像，就是本地仓库的镜像 $ docker image # 构建镜像并推送到本地仓库上 $ docker build -t {仓库IP:port}/flask-web:1.0 . 通过搭建本地仓库，下载镜像后 push 到本地仓库，其他内网机器 pull 的话速度会有所提升。\n一般公司业务不方便放到 docker hub 上，可以通过内网仓库提高隐私性。\ndockerfile 简介 Dockerfile 是由一系列指令和参数构成的脚本，一个 Dockerfile 里面包含了构建整个镜像的完整命令。\n通过 docker build 执行 Dockerfile 中的一系列指令自动构建镜像。\n常用指令 FROM：基础镜像，FROM 命令必须是 dockerfile 的首个命令LABEL：为镜像生成元数据标签信息，作者、版本信息等USER：指定运行容器时的用户名或 UID，默认管理员用户，后续 RUN 也会使用指定用户RUN：是 dockerfile 执行命令的核心部分，接受命令作为参数并用于创建镜像。每条 run 命令在当前基础镜像上执行，并且会提交一个新的镜像层WORKDIR：设置 CMD 命令的运行目录，为后续的 RUN、CMD、ENTRYPOINT、ADD 指令配置工作目录ENV：容器启动的环境变量ARG：构建环境的环境变量，仅供 dockerfile 赋值使用COPY：复制文件CMD：容器运行时执行的默认命令ENTRYPOINT：执行容器的入口HEALTHCHECK：容器健康状态检查演示 使用 dockerfile 构建 nginx 容器，添加容器健康检查\n# Dockerfile# 导入基础镜像FROMnginx:1.17.9# 指定信息LABEL maintainer=\"Ultraman_Tiga\"# 设置环境变量ENV NGINX_VERSION 1.17.9ARG work_pwd=/data/html# 切换用户USERroot# 执行命令# 安装 curl，设置软链把 nginx 服务的日志显示到终端输出RUN apt-get -yq update \u0026\u0026 apt-get install -y curl \u0026\u0026 \\ ln -sf /dev/stdout /var/log/nginx/access.log \u0026\u0026 \\ ln -sf /dev/stderr /var/log/nginx/error.log# 挂载卷VOLUME [\"/data\"]# 设置工作目录WORKDIR$work_pwd# 复制 index.html 文件到 workdir 目录下COPY index.html .# 映射 80 端口EXPOSE80# 此处 CMD 作为 ENTRYPOINT 的参数CMD [\"nginx\", \"-g\", \"daemon off;\"]# 使用 docker stop 指令停止容器时，发出 sigrtmax 指令停止容器STOPSIGNALSIGRTMAX# 检查容器健康，通过访问 Nginx 服务 80 端口，来判断容器是否正常运行HEALTHCHECK --interval=5s --timeout=3s \\ CMD curl -fs http://localhost/ || exit 1构建 # -t 指定标签；. 代表当前路径 $ docker build -t nginx:1 . # 启动 $ docker run -d nginx:1 # 新建一个窗口，进入容器内 $ docker exec -it {container_id} bash root@*****:/data/html$ env # 用户名为指定的 root 用户 # 执行env命令后会出现dockerfile设置的环境变量 # 当前目录就是设置的workdir # 当前目录下存在 index.html root@*****:/data/html$ df -h # 挂载卷为设置的VOLUME /dev/sda1 ... /data 镜像构建 简介 工作中，常常需要制作自己的项目镜像，便于分发给其他同学使用。一般通过以下两种方式制作镜像：\n docker commit dockerfile  docker commit 一般用做从一个运行状态的容器来创建一个新的镜像，定制镜像应该使用 dockerfile 来完成，默认 commit 镜像，对外不可解释，别人不知道该容器的构建环境，不方便排查问题，可维护性差。\n$ docker commit {容器名} {新镜像名}:tag docker build # 忽略文件，构建时不会被打包到镜像内 # 创建一个 .dockerignore 文件，里面写入 Dockerfile* # 指定文件 $ docker build -f # 添加标签 $ docker build -t # 不使用缓存 $ docker build --no-chche # 构建时变量 $ docker build --build-arg 这个帖子不错，留在这里备忘：https://blog.csdn.net/lb245557472/article/details/91966770\n","wordCount":"4201","inLanguage":"en","datePublished":"2021-08-24T14:26:21+08:00","dateModified":"2021-08-24T14:26:21+08:00","author":[{"@type":"Person","name":"ABEE"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://abeelan.github.io/posts/tech/docker/docker/"},"publisher":{"@type":"Organization","name":"ABEE","logo":{"@type":"ImageObject","url":"https://abeelan.github.io/img/favicon.ico"}}}</script></head><body id=top><script>(function(){let a,b=new RegExp("(^| )change-themes=([^;]*)(;|$)");(a=document.cookie.match(b))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark')):(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://abeelan.github.io/ accesskey=h title="ABEE (Alt + H)"><img src=https://abeelan.github.io/img/avatar.gif alt=logo aria-label=logo height=35>ABEE</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://abeelan.github.io/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://abeelan.github.io/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://abeelan.github.io/archives/ title="⏱️ 时间轴"><span>⏱️ 时间轴</span></a></li><li><a href=https://abeelan.github.io/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://abeelan.github.io/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}body{counter-reset:h2}h2{counter-reset:h3}h3{counter-reset:h4}h4{counter-reset:h5}article[autonumbering] h2:before{counter-increment:h2;content:counter(h2)". "}article[autonumbering] h3:before{counter-increment:h3;content:counter(h2)"." counter(h3)" "}article[autonumbering] h4:before{counter-increment:h4;content:counter(h2)"." counter(h3)"." counter(h4)" "}article[autonumbering] .toc ul{counter-reset:item}article[autonumbering] .toc li a:before{content:counters(item,".")" ";counter-increment:item}</style><article class=post autonumbering><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://abeelan.github.io/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://abeelan.github.io/posts/>📚 分类</a>&nbsp;»&nbsp;<a href=https://abeelan.github.io/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>Docker - 了解与基本使用</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span><span>2021-08-24
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span><span>4201字
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span><span>9分钟
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span><span>ABEE
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span><span><span class=post-tags-meta><a href=https://abeelan.github.io/tags/docker/ style=color:var(--secondary)!important>docker</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span><span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span><span><script src=https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://abeelan.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=='/'&&(finalUrl='/'+finalUrl),twikoo.getCommentsCount({envId:null,region:"ap-beijing",urls:[finalUrl],includeReply:!1}).then(function(a){let b=a[0].count;const c=document.getElementById("comment_count");c.innerText=b}).catch(function(a){console.error(a)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%bb%8b%e7%bb%8d aria-label=介绍>介绍</a><ul><li><a href=#%e4%bc%98%e7%82%b9 aria-label=优点>优点</a></li><li><a href=#%e4%b8%8e%e8%99%9a%e6%8b%9f%e6%9c%ba%e7%9a%84%e5%8c%ba%e5%88%ab aria-label=与虚拟机的区别>与虚拟机的区别</a></li><li><a href=#docker-%e6%9e%b6%e6%9e%84 aria-label="Docker 架构">Docker 架构</a></li><li><a href=#%e6%a6%82%e5%bf%b5 aria-label=概念>概念</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85%e4%b8%8e%e9%85%8d%e7%bd%ae aria-label=安装与配置>安装与配置</a></li><li><a href=#%e5%91%bd%e4%bb%a4 aria-label=命令>命令</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4 aria-label=基本命令>基本命令</a></li><li><a href=#%e9%95%9c%e5%83%8f%e7%ae%a1%e7%90%86 aria-label=镜像管理>镜像管理</a></li><li><a href=#%e5%ae%b9%e5%99%a8%e7%ae%a1%e7%90%86 aria-label=容器管理>容器管理</a></li><li><a href=#%e5%ae%b9%e5%99%a8%e5%90%af%e5%8a%a8%e5%8f%82%e6%95%b0%e8%a7%a3%e9%87%8a aria-label=容器启动参数解释>容器启动参数解释</a><ul><ul><li><a href=#%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84-p aria-label=端口映射（-p）>端口映射（-p）</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%ae%bf%e4%b8%bb%e6%9c%ba%e7%bd%91%e7%bb%9c--net-host aria-label="使用宿主机网络（&amp;ndash;net host）">使用宿主机网络（&ndash;net host）</a></li><li><a href=#%e5%ae%b9%e5%99%a8%e9%97%b4%e7%bd%91%e7%bb%9c%e4%ba%92%e9%80%9a--net-container%e5%ae%b9%e5%99%a8%e5%90%8d aria-label="容器间网络互通（&amp;ndash;net container:容器名）">容器间网络互通（&ndash;net container:容器名）</a></li><li><a href=#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f-e aria-label=环境变量（-e）>环境变量（-e）</a></li><li><a href=#%e5%90%8e%e5%8f%b0%e6%89%a7%e8%a1%8c-d aria-label=后台执行（-d）>后台执行（-d）</a></li></ul></ul></li></ul></li><li><a href=#%e6%90%ad%e5%bb%ba-web-%e6%9c%8d%e5%8a%a1%e5%99%a8-nginx aria-label="搭建 Web 服务器 Nginx">搭建 Web 服务器 Nginx</a><ul><li><a href=#nginx-%e7%ae%80%e4%bb%8b aria-label="Nginx 简介">Nginx 简介</a></li><li><a href=#%e8%bf%90%e8%a1%8c-nginx-%e5%ae%b9%e5%99%a8 aria-label="运行 Nginx 容器">运行 Nginx 容器</a></li></ul></li><li><a href=#%e6%90%ad%e5%bb%ba%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b%e7%ae%a1%e7%90%86%e5%b9%b3%e5%8f%b0-testlink aria-label="搭建测试用例管理平台 Testlink">搭建测试用例管理平台 Testlink</a><ul><li><a href=#testlink-%e7%ae%80%e4%bb%8b aria-label="Testlink 简介">Testlink 简介</a></li><li><a href=#%e9%83%a8%e7%bd%b2%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=部署数据库>部署数据库</a></li><li><a href=#%e9%83%a8%e7%bd%b2-testlink aria-label="部署 Testlink">部署 Testlink</a></li></ul></li><li><a href=#%e6%90%ad%e5%bb%ba%e6%8c%81%e7%bb%ad%e9%9b%86%e6%88%90%e5%b9%b3%e5%8f%b0-jenkins aria-label="搭建持续集成平台 Jenkins">搭建持续集成平台 Jenkins</a><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#%e9%83%a8%e7%bd%b2-jenkins aria-label="部署 Jenkins">部署 Jenkins</a></li></ul></li><li><a href=#dcoekr-compose aria-label=Dcoekr-compose>Dcoekr-compose</a><ul><li><a href=#%e7%ae%80%e4%bb%8b-1 aria-label=简介>简介</a></li><li><a href=#%e5%ae%89%e8%a3%85 aria-label=安装>安装</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4 aria-label=常用命令>常用命令</a></li><li><a href=#%e6%bc%94%e7%a4%ba aria-label=演示>演示</a><ul><ul><li><a href=#%e5%90%af%e5%8a%a8 aria-label=启动>启动</a></li></ul></ul></li></ul></li><li><a href=#docker-registry aria-label="Docker registry">Docker registry</a><ul><li><a href=#%e7%ae%80%e4%bb%8b-2 aria-label=简介>简介</a></li><li><a href=#%e8%bf%90%e8%a1%8c aria-label=运行>运行</a></li><li><a href=#%e6%bc%94%e7%a4%ba-1 aria-label=演示>演示</a></li></ul></li><li><a href=#dockerfile aria-label=dockerfile>dockerfile</a><ul><li><a href=#%e7%ae%80%e4%bb%8b-3 aria-label=简介>简介</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e6%8c%87%e4%bb%a4 aria-label=常用指令>常用指令</a></li><li><a href=#%e6%bc%94%e7%a4%ba-2 aria-label=演示>演示</a><ul><ul><li><a href=#%e6%9e%84%e5%bb%ba aria-label=构建>构建</a></li></ul></ul></li></ul></li><li><a href=#%e9%95%9c%e5%83%8f%e6%9e%84%e5%bb%ba aria-label=镜像构建>镜像构建</a><ul><li><a href=#%e7%ae%80%e4%bb%8b-4 aria-label=简介>简介</a></li><li><a href=#docker-commit aria-label="docker commit">docker commit</a></li><li><a href=#docker-build aria-label="docker build">docker build</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener('DOMContentLoaded',function(b){checkTocPosition(),elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'),activeElement=elements[0];const a=encodeURI(activeElement.getAttribute('id')).toLowerCase();document.querySelector(`.inner ul li a[href="#${a}"]`).classList.add('active')},!1),window.addEventListener('resize',function(a){checkTocPosition()},!1),window.addEventListener('scroll',()=>{activeElement=Array.from(elements).find(a=>{if(getOffsetTop(a)-window.pageYOffset>0&&getOffsetTop(a)-window.pageYOffset<window.innerHeight/2)return a})||activeElement,elements.forEach(a=>{const b=encodeURI(a.getAttribute('id')).toLowerCase();a===activeElement?document.querySelector(`.inner ul li a[href="#${b}"]`).classList.add('active'):document.querySelector(`.inner ul li a[href="#${b}"]`).classList.remove('active')})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue('--gap'),10);function checkTocPosition(){const a=document.body.scrollWidth;a-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(a){if(!a.getClientRects().length)return 0;let b=a.getBoundingClientRect(),c=a.ownerDocument.defaultView;return b.top+c.pageYOffset}</script><div class=post-content><p>Docker 是一个开源的应用容器引擎，基于 GO 语言开发，可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的系统。</p><h2 id=介绍>介绍<a hidden class=anchor aria-hidden=true href=#介绍>#</a></h2><h3 id=优点>优点<a hidden class=anchor aria-hidden=true href=#优点>#</a></h3><ul><li>快速交付应用。加快打包时间，加快测试，加快发布，缩短开发及运行代码之间的周期；</li><li>复杂环境管理，应用隔离。不同软件运行环境兼容依赖问题，开发环境、测试环境、线上环境一致；</li><li>轻量级。对于系统内核来说，一个 docker 只是一个进程，一个系统可以运行上千个容器。</li></ul><h3 id=与虚拟机的区别>与虚拟机的区别<a hidden class=anchor aria-hidden=true href=#与虚拟机的区别>#</a></h3><ul><li>容器与容器之间只是进程隔离，而虚拟机是完全的资源隔离；</li><li>虚拟机的启动需要分钟级别，Docker 启动是秒级或者更短；</li><li>容器共享宿主操作系统的内核，减少内核的开销；而虚拟机使用完全独立的内核。</li></ul><h3 id=docker-架构>Docker 架构<a hidden class=anchor aria-hidden=true href=#docker-架构>#</a></h3><p><img loading=lazy src=https://gitee.com/abeelan/image-hosting-service/raw/master/img/image-20210824144814674.png alt=image-20210824144814674></p><h3 id=概念>概念<a hidden class=anchor aria-hidden=true href=#概念>#</a></h3><p><a href=https://zh.wikipedia.org/wiki/Docker>https://zh.wikipedia.org/wiki/Docker</a></p><p>**Docker 镜像（Docker Images）**每一个镜像都可能依赖一个或者多个下层的镜像组成的另一个镜像，AUFS 文件系统；</p><p>**Docker 仓库（Docker Registry）**集中存放镜像的地方；</p><p>**Docker 容器（Docker Containers）**镜像运行后的进程。</p><h2 id=安装与配置>安装与配置<a hidden class=anchor aria-hidden=true href=#安装与配置>#</a></h2><p>官网下载 Desktop：https://www.docker.com/products/docker-desktop</p><h2 id=命令>命令<a hidden class=anchor aria-hidden=true href=#命令>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># CentOS 启动 docker 服务</span>
$ systemctl start docker
$ systemctl restart docker 
$ ststemctl enable docker  <span style=color:#75715e># 开机自启动</span>

<span style=color:#75715e># ubantu 自动启动</span>
<span style=color:#75715e># MacOS 和 Windows 通过桌面版启动</span>
</code></pre></div><h3 id=基本命令>基本命令<a hidden class=anchor aria-hidden=true href=#基本命令>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 查看版本信息</span>
$ docker version
<span style=color:#75715e># 查看系统信息</span>
$ dcoker info
</code></pre></div><h3 id=镜像管理>镜像管理<a hidden class=anchor aria-hidden=true href=#镜像管理>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 查看所有镜像</span>
$ docker images
<span style=color:#75715e># 搜索镜像</span>
$ docker search jenkins
<span style=color:#75715e># 拉取镜像，默认最新版本，可以指定版本</span>
$ docker pull jenkins:latest
<span style=color:#75715e># 导出镜像</span>
$ docker save jenkins:latest &gt; jenkins.tar
<span style=color:#75715e># 导出镜像</span>
$ docker load &lt; jenkins.tar
<span style=color:#75715e># 删除镜像</span>
$ docker rmi jenkins:latest
<span style=color:#75715e># 修改镜像标签名</span>
$ docker tag jenkins:latest jenkins:test
<span style=color:#75715e># 查看镜像创建历史</span>
$ docker history jenkins
</code></pre></div><h3 id=容器管理>容器管理<a hidden class=anchor aria-hidden=true href=#容器管理>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 运行容器；-d 在后台运行</span>
$ docker run -d --name<span style=color:#f92672>=</span>mysql:latest
<span style=color:#75715e># 查看运行中的容器</span>
$ docker ps
$ docker ps -a
<span style=color:#75715e># 查看容器中运行的进程</span>
$ docker top mysql
<span style=color:#75715e># 查看资源占用</span>
$ docker stats mysql 
<span style=color:#75715e># 容器操作</span>
$ docker start/restart/stop/kill mysql
<span style=color:#75715e># 暂停容器</span>
$ docker pause/unpause mysql
<span style=color:#75715e># 强制删除容器</span>
$ docker rm -f mysql
<span style=color:#75715e># 查看容器运行日志</span>
$ docker logs -f <span style=color:#f92672>{</span>CONTAINER_ID<span style=color:#f92672>}</span>
<span style=color:#75715e># 执行命令(-i 交互式 -t 终端方式)</span>
$ docker exec -it mysql bash
<span style=color:#75715e># 复制文件</span>
$ docker cp mysql:/var/tmp .
$ docker cp a.txt mysql:/tmp
<span style=color:#75715e># 查看容器/镜像元信息</span>
$ docker insepct mysql
$ docker inspect -f <span style=color:#e6db74>&#39;{{.Created}}&#39;</span> mysql <span style=color:#75715e># 格式化输出提取</span>
<span style=color:#75715e># 查看容器内文件结构变化</span>
$ docker diff mysql
<span style=color:#75715e># 查看容器原信息；包含 PID、IP 等等</span>
$ docker inspect mysql
</code></pre></div><h3 id=容器启动参数解释>容器启动参数解释<a hidden class=anchor aria-hidden=true href=#容器启动参数解释>#</a></h3><h5 id=端口映射-p>端口映射（-p）<a hidden class=anchor aria-hidden=true href=#端口映射-p>#</a></h5><p>docker 会在虚拟的容器网络内启动容器，容器网络内的容器之间可以互相通信，外部无法与容器进行通信，我们希望将宿主机（启动容器的机器）作为跳板，这样，用户可以将网络请求发送给宿主机，宿主机再转发请求到容器实现通信，所以需要端口映射。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run --name<span style=color:#f92672>=</span>hub -p 5001:4444
</code></pre></div><p>用户将请求发送到宿主机的 5001 端口，宿主机再转发请求到容器的 4444 端口。</p><h5 id=使用宿主机网络--net-host>使用宿主机网络（&ndash;net host）<a hidden class=anchor aria-hidden=true href=#使用宿主机网络--net-host>#</a></h5><p>通过 &ndash;net 指定 host 就可以不用容器网络，直接使用宿主机的网络。</p><h5 id=容器间网络互通--net-container容器名>容器间网络互通（&ndash;net container:容器名）<a hidden class=anchor aria-hidden=true href=#容器间网络互通--net-container容器名>#</a></h5><p>容器 A 使用容器 B 的网络；容器 ABCD 使用容器 E 的网络</p><h5 id=环境变量-e>环境变量（-e）<a hidden class=anchor aria-hidden=true href=#环境变量-e>#</a></h5><p>启动容器时，通过设置环境变量，来控制容器行为。容器内部的程序会读取环境变量，相当于传参。</p><p>比如，通过 mysql 镜像启动容器，不知道用户想设置什么账号密码，那么就通过环境变量来进行设置。</p><h5 id=后台执行-d>后台执行（-d）<a hidden class=anchor aria-hidden=true href=#后台执行-d>#</a></h5><p>如果非后台执行的话，关闭当前窗口或者 ctrl+c 结束命令后，该容器就会停止运行，服务停掉。</p><h2 id=搭建-web-服务器-nginx>搭建 Web 服务器 Nginx<a hidden class=anchor aria-hidden=true href=#搭建-web-服务器-nginx>#</a></h2><h3 id=nginx-简介>Nginx 简介<a hidden class=anchor aria-hidden=true href=#nginx-简介>#</a></h3><p>Nginx（发音同 engine x）是一个异步的 Web 服务器，主要提供 Web 服务、反向代理、负载均衡和 HTTP 缓存功能。由 Igor Sysoev 创建于 2004 年，使用 C 语言开发。</p><p>反向代理：服务器将收到的请求分发到其他服务器</p><p>负载均衡：流量均匀的分布到后端的服务器上</p><p>HTTP缓存：缓存服务器，提高用户访问速度</p><h3 id=运行-nginx-容器>运行 Nginx 容器<a hidden class=anchor aria-hidden=true href=#运行-nginx-容器>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 拉取</span>
$ docker pull nginx:1.17.9

<span style=color:#75715e># 运行</span>
<span style=color:#75715e># 将容器的 80 端口映射到本机的 80 端口，浏览器访问本机 IP 即可看到 nginx 欢迎页</span>
<span style=color:#75715e># 退出后就不能访问了</span>
$ docker run -p 80:80 nginx:1.17.9
<span style=color:#75715e># -d 在后台运行</span>
$ docker run -d --name nginx -p 80:80 nginx
6438442df9b325e8bfc5a8c5ff95dc21e599c0e885a7dbf5687d91c1f44045db
<span style=color:#75715e># -v 挂载目录，在本地的html目录下添加文件，访问服务的 8080 端口就可以看到了</span>
$ docker run -d --name nginx -p 8080:80 -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>/nginx/html:/usr/share/nginx/html nginx:1.17.9
891e09a6bbb5e131f99cd3fe60dfb2687b0939c28ad614d017408ce74478b1a1
$ cd nginx/html
$ vi index.html
&lt;h1&gt;Everythin will be ok.&lt;/h1&gt;
<span style=color:#75715e># 保存后，访问本地服务的8080端口，即可看到页面展示</span>
</code></pre></div><h2 id=搭建测试用例管理平台-testlink>搭建测试用例管理平台 Testlink<a hidden class=anchor aria-hidden=true href=#搭建测试用例管理平台-testlink>#</a></h2><h3 id=testlink-简介>Testlink 简介<a hidden class=anchor aria-hidden=true href=#testlink-简介>#</a></h3><p>Testlink 基于 WEB 的测试用例管理系统，主要功能是测试项目管理、产品需求管理、测试用例管理、测试计划管理、测试用例的创建、管理和执行，并且还提供了统计功能。</p><h3 id=部署数据库>部署数据库<a hidden class=anchor aria-hidden=true href=#部署数据库>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 创建一个名为 testlink 的容器网络</span>
$ docker network create testlink
<span style=color:#75715e># 查看当前存在的容器网络</span>
$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE      备注（自己加的）
4deb334c55f6        bridge              bridge              local      桥接网络
cf4fbaac0160        host                host                local      主机网络
50027393c74d        none                null                local
6ac9853f1eab        testlink            bridge              local      刚才新建的网络
<span style=color:#75715e># 运行数据库，如果本地没有该镜像的话会自动去下载</span>
$ docker run -d --name mariadb -e MARIADB_ROOT_PASSWORD<span style=color:#f92672>=</span>mariadb -e MARIADB_USER<span style=color:#f92672>=</span>bn_testlink -e MARIADB_PASSWORD<span style=color:#f92672>=</span>bn_testlink -e MARIADB_DATABASE<span style=color:#f92672>=</span>bitnami_testlink --net testlink -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>/mariadb:/bitnami bitnami/mariadb:10.3.22

Unable to find image <span style=color:#e6db74>&#39;bitnami/mariadb:10.3.22&#39;</span> locally
10.3.22: Pulling from bitnami/mariadb
...
74dbf92d3ddca4d241f2b9022890445820f7e26e5324c352c90983515379bd65
</code></pre></div><h3 id=部署-testlink>部署 Testlink<a hidden class=anchor aria-hidden=true href=#部署-testlink>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 运行 testlink</span>
$ docker run -d -p 80:8080 -p 443:8443 --name testlink -e TESTLINK_DATABASE_USER<span style=color:#f92672>=</span>bn_testlink -e TESTLINK_DATABASE_PASSWORD<span style=color:#f92672>=</span>bn_testlink -e TESTLINK_DATABASE_NAME<span style=color:#f92672>=</span>bitnami_testlink --net testlink -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>/testlink:/bitnami bitnami/testlink:1.9.20

Unable to find image <span style=color:#e6db74>&#39;bitnami/testlink:1.9.20&#39;</span> locally
1.9.20: Pulling from bitnami/testlink
...
5e766b7f386db5c0bdb3adcb14c1daea6f5f9517f56dfc9af556fbcb4c6e1bc9
</code></pre></div><p>在浏览器访问本地 IP 地址，即可正常浏览网页。</p><p>默认用户名：user；默认密码：bitnami。</p><h2 id=搭建持续集成平台-jenkins>搭建持续集成平台 Jenkins<a hidden class=anchor aria-hidden=true href=#搭建持续集成平台-jenkins>#</a></h2><h3 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h3><p>Jenkins 是开源的 CI&CD 软件领导者，提供持续集成和持续交付服务，有超过 1000 个插件来支持构建、部署、自动化，满足任何项目的需要。</p><h3 id=部署-jenkins>部署 Jenkins<a hidden class=anchor aria-hidden=true href=#部署-jenkins>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 运行</span>
$ docker run -d --name jenkins -p 8080:8080 jenkins/jenkins

Unable to find image <span style=color:#e6db74>&#39;jenkins/jenkins:latest&#39;</span> locally
latest: Pulling from jenkins/jenkins
...
0f2b01bf74d566fe6ea90790307ccd1de317f1095b1d3056a3986c0eaee8c856

<span style=color:#75715e># 首次启动需要管理员密码，通过日志可以查看</span>
$ docker logs -f jenkins
...
*************************************************************

Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

207e5af52d004e058e48e66c751b5086

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword

*************************************************************
<span style=color:#75715e># 也可以去文件内查看默认密码</span>
$ docker exec -it jenkins cat /var/jenkins_home/secrets/initialAdminPassword
207e5af52d004e058e48e66c751b5086

<span style=color:#75715e># 挂载目录，由于容器名称不能重复，需要删除之前的容器或者更换名字</span>
$ docker run -d --name jenkins -p 8080:8080 -p 50000:50000 -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>/jenkins:/var/jenkins_home jenkins/jenkins
<span style=color:#75715e># 如果启动失败，添加下权限后重启即可</span>
$ chmod <span style=color:#ae81ff>777</span> jenkins  
$ docker restart jenkins
</code></pre></div><h2 id=dcoekr-compose>Dcoekr-compose<a hidden class=anchor aria-hidden=true href=#dcoekr-compose>#</a></h2><h3 id=简介-1>简介<a hidden class=anchor aria-hidden=true href=#简介-1>#</a></h3><p>Docker-compose 是用于定义和运行多容器的 Docker 应用程序的工具。通过 compose，可以使用 yaml 文件来配置应用程序的服务。compose 的使用一般分为三步：</p><ol><li>使用 Dockerfile 定义应用程序的环境，以便可以在任何地方复制它；</li><li>在 docker-compose.yml 中定义组成应用程序的服务，以便他们可以在隔离的环境中一起运行；</li><li>运行 docker-compose up，然后 compose 启动并运行您的整个应用程序。</li></ol><h3 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h3><p>macOS、windwos 上的 Desktop 版本，默认已经安装</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 验证</span>
$ docker-compose version
docker-compose version 1.23.2, build 1110ad01
docker-py version: 3.6.0
CPython version: 3.6.6
OpenSSL version: OpenSSL 1.1.0h  <span style=color:#ae81ff>27</span> Mar <span style=color:#ae81ff>2018</span>
</code></pre></div><h3 id=常用命令>常用命令<a hidden class=anchor aria-hidden=true href=#常用命令>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 查看配置</span>
$ docker-compose config
<span style=color:#75715e># 后台启动</span>
$ docker-compose up -d
<span style=color:#75715e># 构建镜像</span>
$ docker-compose build
<span style=color:#75715e># 下载镜像</span>
$ docker-compose pull
<span style=color:#75715e># 正在运行</span>
$ docker-compose ps 
<span style=color:#75715e># 进程</span>
$ docker-compose top
<span style=color:#75715e># 启动</span>
$ docker-compose start
<span style=color:#75715e># 停止</span>
$ docker-compose stop
</code></pre></div><h3 id=演示>演示<a hidden class=anchor aria-hidden=true href=#演示>#</a></h3><p>通过一个 Python web 小实例来演示 Docker-compose 的功能。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#75715e># docker-compose.yml</span>
<span style=color:#75715e># 指定 docker-compose API 版本</span>
<span style=color:#75715e># 在当前目录下运行 docker-compose config 可以验证变量具体的值</span>
<span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
<span style=color:#f92672>services</span>:
	<span style=color:#f92672>web</span>:
		<span style=color:#f92672>build</span>:
			<span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
		<span style=color:#f92672>depends_on</span>:
			- <span style=color:#ae81ff>redis</span>
		<span style=color:#f92672>ports</span>:
			- <span style=color:#e6db74>&#34;5000:5000&#34;</span>
	
	<span style=color:#f92672>redis</span>:
		<span style=color:#f92672>image</span>: <span style=color:#ae81ff>${REDIS_VERSION}</span>
		<span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#75715e># .env</span>
<span style=color:#a6e22e>REDIS_VERSION</span><span style=color:#f92672>=</span><span style=color:#e6db74>redis:alpine</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># Dockerfile</span>
FROM python:3.7-alpine
LABEL maintainer<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;test&#34;</span>

<span style=color:#75715e># 工作路径设定为 /code</span>
WORKDIR /code

<span style=color:#75715e># 创建环境变量给 Flask 使用</span>
ENV FLASK_APP app.py
ENV FLASK_RUN_HOST 0.0.0.0


<span style=color:#75715e># 复制 app.py 到容器内的 /code 目录</span>
COPY app.py /code

<span style=color:#75715e># 安装 gcc 工具、python 依赖</span>
RUN pip install flask <span style=color:#f92672>&amp;&amp;</span> pip install redis

<span style=color:#75715e># 映射端口</span>
EXPOSE <span style=color:#ae81ff>5000</span>

STOPSIGNAL SIGTERM

<span style=color:#75715e># 为容器设置默认启动命令</span>
CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;flask&#34;</span>, <span style=color:#e6db74>&#34;run&#34;</span><span style=color:#f92672>]</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># app.py</span>
<span style=color:#75715e># 实现统计访问次数</span>
<span style=color:#f92672>import</span> time
<span style=color:#f92672>import</span> redis
<span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask

app <span style=color:#f92672>=</span> Flask(__name__)
cache <span style=color:#f92672>=</span> redis<span style=color:#f92672>.</span>Redis(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;redis&#39;</span>, port<span style=color:#f92672>=</span><span style=color:#ae81ff>6379</span>)


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_hit_count</span>():
	retries <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
	<span style=color:#66d9ef>while</span> True:
		<span style=color:#66d9ef>try</span>:
			<span style=color:#66d9ef>return</span> cache<span style=color:#f92672>.</span>incr(<span style=color:#e6db74>&#34;hits&#34;</span>)
		<span style=color:#66d9ef>except</span> redis<span style=color:#f92672>.</span>exceptions<span style=color:#f92672>.</span>ConnectionError <span style=color:#66d9ef>as</span> e:
			<span style=color:#66d9ef>if</span> retries <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
				<span style=color:#66d9ef>raise</span> e
			retries <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
			time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.5</span>)

<span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hello</span>():
	count <span style=color:#f92672>=</span> get_hit_count()
	<span style=color:#66d9ef>return</span> f<span style=color:#e6db74>&#34;Hello World! I have been seen {count} times.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><h5 id=启动>启动<a hidden class=anchor aria-hidden=true href=#启动>#</a></h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker-compoes up -d
</code></pre></div><h2 id=docker-registry>Docker registry<a hidden class=anchor aria-hidden=true href=#docker-registry>#</a></h2><h3 id=简介-2>简介<a hidden class=anchor aria-hidden=true href=#简介-2>#</a></h3><p>Docker Registry 是存储 Dcoker Image 的仓库，运行 push、pull、search 时，是通过 Docker daemon 与 docker registry 通信。有时候使用 Docker Hub 这样的公共仓库可能不方便，我们可以通过 registry 创建一个本地仓库。</p><h3 id=运行>运行<a hidden class=anchor aria-hidden=true href=#运行>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 搭建仓库的主机运行</span>
$ docker run -d -p 5000:5000 -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>/registry:/var/lib/registry --restart always --name registry registry:2.7.1
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 其他机配置下镜像仓库</span>
$ vim /etc/docker/daemon.json
<span style=color:#f92672>{</span>
	<span style=color:#e6db74>&#34;insecure-registries&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;{仓库主机的IP地址和端口号}&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
$ systemctl restart docker  <span style=color:#75715e># 重启下docker</span>
</code></pre></div><h3 id=演示-1>演示<a hidden class=anchor aria-hidden=true href=#演示-1>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 搭建仓库的主机：先从 docker hub 上随便下载一个镜像</span>
$ docker pull nginx:1.18.0
<span style=color:#75715e># 打上带主机 IP 地址的标签</span>
$ docker tag nginx:1.18.0 <span style=color:#f92672>{</span>仓库地址<span style=color:#f92672>}</span>/nginx:1.18.0
<span style=color:#75715e># 推送到内网仓库下</span>
$ docker push <span style=color:#f92672>{</span>仓库IP:port<span style=color:#f92672>}</span>/nginx:1.18.0

<span style=color:#75715e># 其他机器</span>
$ docker pull <span style=color:#f92672>{</span>仓库IP:port<span style=color:#f92672>}</span>/nginx:1.18.0
<span style=color:#75715e># 查看下载的镜像，就是本地仓库的镜像</span>
$ docker image
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 构建镜像并推送到本地仓库上</span>
$ docker build -t <span style=color:#f92672>{</span>仓库IP:port<span style=color:#f92672>}</span>/flask-web:1.0 .
</code></pre></div><p>通过搭建本地仓库，下载镜像后 push 到本地仓库，其他内网机器 pull 的话速度会有所提升。</p><p>一般公司业务不方便放到 docker hub 上，可以通过内网仓库提高隐私性。</p><h2 id=dockerfile>dockerfile<a hidden class=anchor aria-hidden=true href=#dockerfile>#</a></h2><h3 id=简介-3>简介<a hidden class=anchor aria-hidden=true href=#简介-3>#</a></h3><p>Dockerfile 是由一系列指令和参数构成的脚本，一个 Dockerfile 里面包含了构建整个镜像的完整命令。</p><p>通过 <strong>docker build</strong> 执行 Dockerfile 中的一系列指令自动构建镜像。</p><h3 id=常用指令>常用指令<a hidden class=anchor aria-hidden=true href=#常用指令>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#66d9ef>FROM</span><span style=color:#e6db74>：基础镜像，FROM 命令必须是 dockerfile 的首个命令</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>LABEL</span>：为镜像生成元数据标签信息，作者、版本信息等<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74>：指定运行容器时的用户名或 UID，默认管理员用户，后续 RUN 也会使用指定用户</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span>：是 dockerfile 执行命令的核心部分，接受命令作为参数并用于创建镜像。每条 run 命令在当前基础镜像上执行，并且会提交一个新的镜像层<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74>：设置 CMD 命令的运行目录，为后续的 RUN、CMD、ENTRYPOINT、ADD 指令配置工作目录</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span>：容器启动的环境变量<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span>：构建环境的环境变量，仅供 dockerfile 赋值使用<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span>：复制文件<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span>：容器运行时执行的默认命令<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span>：执行容器的入口<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK</span>：容器健康状态检查<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><h3 id=演示-2>演示<a hidden class=anchor aria-hidden=true href=#演示-2>#</a></h3><p>使用 dockerfile 构建 nginx 容器，添加容器健康检查</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#75715e># Dockerfile</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 导入基础镜像</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:1.17.9</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 指定信息</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>LABEL</span> maintainer<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Ultraman_Tiga&#34;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 设置环境变量</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NGINX_VERSION 1.17.9<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> work_pwd<span style=color:#f92672>=</span>/data/html<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 切换用户</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> root</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 执行命令</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 安装 curl，设置软链把 nginx 服务的日志显示到终端输出</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get -yq update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y curl <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>ln -sf /dev/stdout /var/log/nginx/access.log <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>ln -sf /dev/stderr /var/log/nginx/error.log<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 挂载卷</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>VOLUME</span> [<span style=color:#e6db74>&#34;/data&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 设置工作目录</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> $work_pwd</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 复制 index.html 文件到 workdir 目录下</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> index.html .<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 映射 80 端口</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 此处 CMD 作为 ENTRYPOINT 的参数</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;nginx&#34;</span>, <span style=color:#e6db74>&#34;-g&#34;</span>, <span style=color:#e6db74>&#34;daemon off;&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 使用 docker stop 指令停止容器时，发出 sigrtmax 指令停止容器</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>STOPSIGNAL</span><span style=color:#e6db74> SIGRTMAX</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 检查容器健康，通过访问 Nginx 服务 80 端口，来判断容器是否正常运行</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=5s --timeout=3s \
</span><span style=color:#960050;background-color:#1e0010>  </span><span style=color:#66d9ef>CMD</span> curl -fs http://localhost/ <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><h5 id=构建>构建<a hidden class=anchor aria-hidden=true href=#构建>#</a></h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># -t 指定标签；. 代表当前路径</span>
$ docker build -t nginx:1 .
<span style=color:#75715e># 启动</span>
$ docker run -d nginx:1
<span style=color:#75715e># 新建一个窗口，进入容器内</span>
$ docker exec -it <span style=color:#f92672>{</span>container_id<span style=color:#f92672>}</span> bash
root@*****:/data/html$ env
<span style=color:#75715e># 用户名为指定的 root 用户</span>
<span style=color:#75715e># 执行env命令后会出现dockerfile设置的环境变量</span>
<span style=color:#75715e># 当前目录就是设置的workdir</span>
<span style=color:#75715e># 当前目录下存在 index.html</span>
root@*****:/data/html$ df -h
<span style=color:#75715e># 挂载卷为设置的VOLUME</span>
/dev/sda1 ... /data
</code></pre></div><h2 id=镜像构建>镜像构建<a hidden class=anchor aria-hidden=true href=#镜像构建>#</a></h2><h3 id=简介-4>简介<a hidden class=anchor aria-hidden=true href=#简介-4>#</a></h3><p>工作中，常常需要制作自己的项目镜像，便于分发给其他同学使用。一般通过以下两种方式制作镜像：</p><ul><li>docker commit</li><li>dockerfile</li></ul><h3 id=docker-commit>docker commit<a hidden class=anchor aria-hidden=true href=#docker-commit>#</a></h3><p>一般用做从一个运行状态的容器来创建一个新的镜像，定制镜像应该使用 dockerfile 来完成，默认 commit 镜像，对外不可解释，别人不知道该容器的构建环境，不方便排查问题，可维护性差。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker commit <span style=color:#f92672>{</span>容器名<span style=color:#f92672>}</span> <span style=color:#f92672>{</span>新镜像名<span style=color:#f92672>}</span>:tag
</code></pre></div><h3 id=docker-build>docker build<a hidden class=anchor aria-hidden=true href=#docker-build>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 忽略文件，构建时不会被打包到镜像内</span>
<span style=color:#75715e># 创建一个 .dockerignore 文件，里面写入</span>
Dockerfile*

<span style=color:#75715e># 指定文件</span>
$ docker build -f
<span style=color:#75715e># 添加标签</span>
$ docker build -t
<span style=color:#75715e># 不使用缓存</span>
$ docker build --no-chche
<span style=color:#75715e># 构建时变量</span>
$ docker build --build-arg
</code></pre></div><p>这个帖子不错，留在这里备忘：https://blog.csdn.net/lb245557472/article/details/91966770</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://abeelan.github.io/img/wechatpay.jpg alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://abeelan.github.io/img/alipay.jpg alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick="var qr=document.getElementById('QR');qr.style.opacity==='0'?qr.style.opacity='1':qr.style.opacity='0'">
<span>🧧 鼓励一下 🧧</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://abeelan.github.io/posts/tech/docker/docker-selenium/><span class=title>« 上一页</span><br><span>Docker - 搭建 selenium 分布式测试环境</span></a>
<a class=next href=https://abeelan.github.io/posts/tech/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/burpsuite%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/><span class=title>下一页 »</span><br><span>Burpsuite - 基本使用</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on twitter" href="https://twitter.com/intent/tweet/?text=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&url=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f&hashtags=docker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f&title=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&summary=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&source=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f&title=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on whatsapp" href="https://api.whatsapp.com/send?text=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%20-%20https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker - 了解与基本使用 on telegram" href="https://telegram.me/share/url?text=Docker%20-%20%e4%ba%86%e8%a7%a3%e4%b8%8e%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&url=https%3a%2f%2fabeelan.github.io%2fposts%2ftech%2fdocker%2fdocker%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://abeelan.github.io/ style=color:#939393>ABEE</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0"></a></span>
<span id=busuanzi_container><span class="fa fa-user"></span><span id=busuanzi_value_site_uv></span><span class="fa fa-eye"></span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a><script>document.addEventListener('scroll',function(e){const a=document.getElementById("read_progress"),b=document.documentElement.scrollHeight,c=document.documentElement.clientHeight,d=document.documentElement.scrollTop||document.body.scrollTop;a.innerText=((d/(b-c)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.body.addEventListener('copy',function(a){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let b=a.clipboardData||window.clipboardData;if(b){a.preventDefault();let c=window.getSelection().toString()+'\r\n\n————————————————\r\n'+'版权声明：本文为「'+"ABEE"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。'+'\r\n原文链接：'+location.href,d=window.getSelection().toString()+'\r\n\n————————————————\r\n'+'版权声明：本文为「'+"ABEE"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。'+'\r\n原文链接：'+location.href;b.setData('text/html',c),b.setData('text/plain',d)}}})</script><script>document.querySelectorAll('pre > code').forEach(c=>{const d=c.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='📄 复制';function i(){a.innerText='👌🏻 已复制!',setTimeout(()=>{a.innerText='📄 复制'},2e3)}a.addEventListener('click',d=>{if('clipboard'in navigator){let a=c.textContent+'\r\n————————————————\r\n'+'版权声明：本文为「'+"ABEE"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。'+'\r\n原文链接：'+location.href;navigator.clipboard.writeText(a),i();return}const a=document.createRange();a.selectNodeContents(c);const b=window.getSelection();b.removeAllRanges(),b.addRange(a);try{document.execCommand('copy'),i()}catch(a){}b.removeRange(a)});let j=c.className.replaceAll("language-",""),b=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),e=document.createElement("div");e.innerText=j,b.setAttribute('class','mac-tool'),f.setAttribute('class','mac bb1'),g.setAttribute('class','mac bb2'),h.setAttribute('class','mac bb3'),e.setAttribute('class','language-type'),b.appendChild(f),b.appendChild(g),b.appendChild(h),b.appendChild(e),d.classList.contains("highlight")?(d.appendChild(a),d.appendChild(b)):d.parentNode.firstChild==d||(c.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(c.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a),d.appendChild(b)):(c.parentNode.appendChild(a),d.appendChild(b)))})</script><script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&($(this).css("width","135%"),$(this).css("border-top-right-radius","var(--radius)"))}).on("mouseout",function(){$(this).css("width","100%"),$(this).css("border-top-right-radius","unset")})</script></body></html>