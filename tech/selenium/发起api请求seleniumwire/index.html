<!doctype html><html lang=zh-cn data-theme=light>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width">
<meta name=theme-color content="#336699" media="(prefers-color-scheme: light)">
<meta name=generator content="Hugo 0.89.0">
<link rel="shortcut icon" type=image/x-icon href=/imgs/favicon.ico>
<link rel=icon type=image/x-icon href=/imgs/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png>
<link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png>
<link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png>
<meta itemprop=name content="Selenium - 发起Api请求Seleniumwire">
<meta itemprop=description content="It's better late than never.">
<meta itemprop=datePublished zgotmplz>
<meta itemprop=dateModified zgotmplz>
<meta itemprop=image content="https://abeelan.github.io/imgs/avatar.png">
<meta itemprop=keywords content="Selenium">
<meta property="og:type" content="article">
<meta property="og:title" content="Selenium - 发起Api请求Seleniumwire">
<meta property="og:description" content="It's better late than never.">
<meta property="og:image" content="/imgs/avatar.png">
<meta property="og:image:width" content="312">
<meta property="og:image:height" content="312">
<meta property="og:image:type" content="image/jpeg/png/svg/jpg">
<meta property="og:url" content="https://abeelan.github.io/tech/selenium/%E5%8F%91%E8%B5%B7api%E8%AF%B7%E6%B1%82seleniumwire/">
<meta property="og:site_name" content="ABEE">
<meta property="og:locale" content="zh-CN">
<meta property="article:author" content="ABEE">
<meta property="article:published_time" content="2022-11-22 12:13:59 +0000 UTC">
<meta property="article:modified_time" content="2023-06-02 16:42:04 +0000 UTC">
<link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css>
<link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css>
<link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css>
<link rel=stylesheet href=/css/main.min.416f334245da30571f15db9831a2d6c55688e61dcb41988411ebe865602b54fd.css>
<style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style>
<script type=text/javascript>(function(){localDB={set:function(b,c,a){if(a===0)return;const d=new Date,e=a*864e5,f={value:c,expiry:d.getTime()+e};localStorage.setItem(b,JSON.stringify(f))},get:function(a){const b=localStorage.getItem(a);if(!b)return void 0;const c=JSON.parse(b),d=new Date;return d.getTime()>c.expiry?(localStorage.removeItem(a),void 0):c.value}},theme={active:function(){const a=localDB.get('theme');if(a==void 0)return;theme.toggle(a),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(a){theme.toggle(a.matches?'dark':'light')})},toggle:function(a){document.documentElement.setAttribute('data-theme',a),localDB.set('theme',a,2);const b=document.querySelector('iframe.giscus-frame');if(b){const c={setConfig:{theme:a}};b.contentWindow.postMessage({giscus:c},'https://giscus.app')}}},theme.active()})(window)</script>
<script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"%E5%8F%91%E8%B5%B7api%E8%AF%B7%E6%B1%82seleniumwire","permalink":"https://abeelan.github.io/tech/selenium/%E5%8F%91%E8%B5%B7api%E8%AF%B7%E6%B1%82seleniumwire/","title":"Selenium - 发起Api请求Seleniumwire"}</script>
<script type=text/javascript>document.addEventListener('DOMContentLoaded',()=>{var a=document.createElement('script');a.charset="UTF-8",a.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",a.async=!1,a.defer=!0,document.head.appendChild(a),a.onload=function(){NexT.utils.fmtBusuanzi()}})</script>
<title>Selenium - 发起Api请求Seleniumwire - ABEE</title>
<noscript>
<link rel=stylesheet href=/css/noscript.css>
</noscript>
</head>
<body itemscope itemtype=http://schema.org/WebPage class=use-motion>
<div class=headband></div>
<main class=main>
<header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner>
<div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle aria-label=切换导航栏 role=button>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<a href=/ class=brand rel=start>
<i class=logo-line></i>
<h1 class=site-title>ABEE</h1>
<i class=logo-line></i>
</a>
<p class=site-subtitle itemprop=description>个人工作/学习笔记 📒</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger">
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul class="main-menu menu">
<li class="menu-item menu-item-home">
<a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>主页
</a>
</li>
<li class="menu-item menu-item-about">
<a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于
</a>
</li>
<li class="menu-item menu-item-archives">
<a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>140</span>
</a>
</li>
<li class="menu-item menu-item-search">
<a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索
</a>
</li>
</ul>
</nav>
<div class=search-pop-overlay>
<div class="popup search-popup">
<div class=search-header>
<span class=search-icon>
<i class="fa fa-search"></i>
</span>
<div class=search-input-container>
<input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input>
</div>
<span class=popup-btn-close role=button>
<i class="fa fa-times-circle"></i>
</span>
</div>
<div class="search-result-container no-result">
<div class=search-result-icon>
<i class="fa fa-spinner fa-pulse fa-5x"></i>
</div>
</div>
</div>
</div>
</div>
<div class="toggle sidebar-toggle" role=button>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
<aside class=sidebar>
<div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
<ul class=sidebar-nav>
<li class=sidebar-nav-toc>
文章目录
</li>
<li class=sidebar-nav-overview>
站点概览
</li>
</ul>
<div class=sidebar-panel-container>
<div class="post-toc-wrap sidebar-panel">
<div class="post-toc animated"><nav id=TableOfContents>
<ul>
<li><a href=#特性>特性</a></li>
<li><a href=#安装>安装</a></li>
<li><a href=#使用>使用</a>
<ul>
<li>
<ul>
<li></li>
</ul>
</li>
</ul>
</li>
<li><a href=#请求对象>请求对象</a>
<ul>
<li><a href=#websocketmessage-对象>WebSocketMessage 对象</a></li>
</ul>
</li>
<li><a href=#响应对象>响应对象</a></li>
<li><a href=#拦截请求和响应>拦截请求和响应</a>
<ul>
<li><a href=#示例添加请求头>示例：添加请求头</a></li>
<li><a href=#示例替换现有请求标头>示例：替换现有请求标头</a></li>
<li><a href=#示例添加响应标头>示例：添加响应标头</a></li>
<li><a href=#示例添加请求参数>示例：添加请求参数</a></li>
<li><a href=#示例更新-post-请求正文中的-json>示例：更新 POST 请求正文中的 JSON</a></li>
<li><a href=#示例基本身份验证>示例：基本身份验证</a></li>
<li><a href=#示例阻止请求>示例：阻止请求</a></li>
<li><a href=#示例模拟响应>示例：模拟响应</a></li>
<li><a href=#取消设置拦截器>取消设置拦截器</a></li>
</ul>
</li>
<li><a href=#限制请求捕获>限制请求捕获</a></li>
<li><a href=#请求存储>请求存储</a>
<ul>
<li><a href=#内存存储>内存存储</a></li>
</ul>
</li>
<li><a href=#代理>代理</a>
<ul>
<li><a href=#socket>Socket</a></li>
<li><a href=#动态切换>动态切换</a></li>
</ul>
</li>
<li><a href=#机器人检测>机器人检测</a></li>
<li><a href=#证书>证书</a>
<ul>
<li><a href=#使用您自己的证书>使用您自己的证书</a></li>
</ul>
</li>
<li><a href=#所有选项>所有选项</a></li>
</ul>
</nav></div>
</div>
<div class="site-overview-wrap sidebar-panel">
<div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image alt=ABEE src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.png>
<p class=site-author-name itemprop=name>ABEE</p>
<div class=site-description itemprop=description>It's better late than never.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
<nav class=site-state>
<div class="site-state-item site-state-posts">
<a href=/archives/>
<span class=site-state-item-count>140</span>
<span class=site-state-item-name>帖子</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>21</span>
<span class=site-state-item-name>分类</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>21</span>
<span class=site-state-item-name>标签</span>
</a>
</div>
</nav>
</div>
<div class="links-of-social site-overview-item animated">
<span class=links-of-social-item>
<a href=https://github.com/abeelan title="Github → https://github.com/abeelan" rel=noopener class=hvr-icon-pulse target=_blank>
<i class="fab fa-github fa-fw hvr-icon"></i>Github
</a>
</span>
</div>
</div>
</div>
</div>
<div id=siteinfo-card-widget class=sidebar-card-widget>
<div class=item-headline>
<i class="fas fa-chart-line"></i>
<span>网站资讯</span>
</div>
<div class=siteinfo>
<div class=siteinfo-item>
<div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div>
<div class=item-count id=runTimes data-publishdate=2023-06-01T17:50:58+00:00></div>
</div>
<div class=siteinfo-item>
<div class=item-name>
<i class="fas fa fa-user"></i>总访客数：
</div>
<div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div>
</div>
<div class=siteinfo-item>
<div class=item-name>
<i class="fas fa fa-eye"></i>页面浏览：
</div>
<div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div>
</div>
<div class=siteinfo-item>
<div class=item-name><i class="fa fa-font"></i>总字数：</div>
<div class=item-count id=wordsCount data-count=191098></div>
</div>
<div class=siteinfo-item>
<div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div>
<div class=item-count id=readTimes data-times=456></div>
</div>
<div class=siteinfo-item>
<div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div>
<div class=item-count id=last-push-date data-lastpushdate=2023-06-01T16:17:01+00:00></div>
</div>
</div>
</div>
</aside>
<div class=sidebar-dimmer></div>
</header>
<div class=tool-buttons>
<div id=goto-comments class="button goto-comments" title=直达评论>
<i class="fas fa-comments"></i>
</div>
<div id=toggle-theme class=button title=深浅模式切换>
<i class="fas fa-adjust"></i>
</div>
<div class=back-to-top role=button title=返回顶部>
<i class="fa fa-arrow-up"></i>
<span>0%</span>
</div>
</div>
<div class=reading-progress-bar></div>
<a role=button class="book-mark-link book-mark-link-fixed"></a>
<noscript>
<div class=noscript-warning>Theme NexT works best with JavaScript enabled</div>
</noscript>
<div class="main-inner post posts-expand">
<div class=post-block>
<article itemscope itemtype=http://schema.org/Article class=post-content lang>
<link itemprop=mainEntityOfPage href=https://abeelan.github.io/tech/selenium/%E5%8F%91%E8%B5%B7api%E8%AF%B7%E6%B1%82seleniumwire/>
<span hidden itemprop=author itemscope itemtype=http://schema.org/Person>
<meta itemprop=image content="/imgs/avatar.png">
<meta itemprop=name content="ABEE">
</span>
<span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization>
<meta itemprop=name content="ABEE">
<meta itemprop=description content="It's better late than never.">
</span>
<span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork>
<meta itemprop=name content="Selenium - 发起Api请求Seleniumwire">
<meta itemprop=description content="SeleniumWire 是 Selenium 的扩展，可以获取浏览器发出的请求数据。编写代码方式不变，增加额外的 API 来检查请求和响应并即时更改它们。 特性 纯 Python，用户友好的 API 捕">
</span>
<header class=post-header>
<h1 class=post-title itemprop="name headline">Selenium - 发起Api请求Seleniumwire </h1>
<div class=post-meta-container>
<div class=post-meta-items>
<span class=post-meta-item>
<span class=post-meta-item-icon>
<i class="far fa-calendar"></i>
</span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-11-22 12:13:59 +0000 UTC" itemprop="dateCreated datePublished" datetime="2022-11-22 12:13:59 +0000 UTC">2022-11-22</time>
</span>
<span class=post-meta-item>
<span class=post-meta-item-icon>
<i class="far fa-calendar-check"></i>
</span>
<span class=post-meta-item-text>更新于：</span>
<time title=修改时间：2023-06-02T16:42:04+00:00 itemprop=dateModified datetime=2023-06-02T16:42:04+00:00>2023-06-02</time>
</span>
<span class=post-meta-item>
<span class=post-meta-item-icon>
<i class="far fa-folder-open"></i>
</span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing>
<a href=/categories/selenium itemprop=url rel=index>
<span itemprop=name>Selenium</span>
</a>
</span>
</span>
</div>
<div class=post-meta-items>
<span class=post-meta-item title=字数>
<span class=post-meta-item-icon>
<i class="far fa-file-word"></i>
</span>
<span class=post-meta-item-text>字数：</span><span>6069</span>
</span>
<span class=post-meta-item title=阅读>
<span class=post-meta-item-icon>
<i class="far fa-clock"></i>
</span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>13分钟</span>
</span>
<span class=post-meta-item title=浏览>
<span class=post-meta-item-icon>
<i class="far fa-eye"></i>
</span>
<span class=post-meta-item-text>
浏览：
</span>
<span id=busuanzi_value_page_pv data-path=/tech/selenium/%E5%8F%91%E8%B5%B7api%E8%AF%B7%E6%B1%82seleniumwire/>
<i class="fa fa-sync fa-spin"></i>
</span>
</span>
</div>
</div>
</header>
<div class="post-body autonumber" itemprop=articleBody>
<blockquote>
<p>
<a href=https://github.com/wkeeling/selenium-wire title=SeleniumWire rel="noopener external nofollow noreferrer" target=_blank class=exturl>
SeleniumWire
<i class="fa fa-external-link-alt"></i>
</a> 是 Selenium 的扩展，可以获取浏览器发出的请求数据。编写代码方式不变，增加额外的 API 来检查请求和响应并即时更改它们。</p>
</blockquote>
<h2 id=特性>特性</h2>
<ul>
<li>纯 Python，用户友好的 API</li>
<li>捕获 <code>HTTP</code> 和 <code>HTTPS</code> 请求</li>
<li>拦截请求和响应</li>
<li>即时修改标题、参数、正文内容</li>
<li>捕获 <code>websocket</code> 消息</li>
<li>支持 <code>HAR</code> 格式</li>
<li>代理服务器支持</li>
</ul>
<p>兼容性：</p>
<ul>
<li>Python 3.7+</li>
<li>Selenium 4.0.0+</li>
<li>支持 Chrome、Firefox、Edge 和 Remote Webdriver</li>
</ul>
<h2 id=安装>安装</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#75715e># python 库安装</span>
$ pip install selenium-wire

<span style=color:#75715e># 需要 OpenSSL 来解密 HTTPS 请求。</span>
<span style=color:#75715e># Linux</span>
<span style=color:#75715e># For apt based Linux systems</span>
$ sudo apt install openssl
<span style=color:#75715e># For RPM based Linux systems</span>
$ sudo yum install openssl
<span style=color:#75715e># For Linux alpine</span>
$ sudo apk add openssl
<span style=color:#75715e># For Mac</span>
$ brew install openssl
<span style=color:#75715e># windows 无需安装</span>

<span style=color:#75715e># check</span>
$ openssl version
LibreSSL 2.8.3
</code></pre></div><h2 id=使用>使用</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#f92672>from</span> seleniumwire <span style=color:#f92672>import</span> webdriver

driver <span style=color:#f92672>=</span> webdriver<span style=color:#f92672>.</span>Chrome()
driver<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;https://www.example.com&#39;</span>)

<span style=color:#75715e># Access requests via the `requests` attribute</span>
<span style=color:#66d9ef>for</span> request <span style=color:#f92672>in</span> driver<span style=color:#f92672>.</span>requests:
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>response:
        print(
            request<span style=color:#f92672>.</span>method,
            request<span style=color:#f92672>.</span>url,
            request<span style=color:#f92672>.</span>response<span style=color:#f92672>.</span>status_code,
            request<span style=color:#f92672>.</span>response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Content-Type&#39;</span>],
            request<span style=color:#f92672>.</span>response<span style=color:#f92672>.</span>body,
            request<span style=color:#f92672>.</span>response<span style=color:#f92672>.</span>date
        )
driver<span style=color:#f92672>.</span>quit()
</code></pre></div><h5 id=远程浏览器>远程浏览器</h5>
<p>TODO：目前报错，需要启动一个远程代理服务，接收请求</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python>options <span style=color:#f92672>=</span> {
    <span style=color:#e6db74>&#39;addr&#39;</span>: <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>  
}
driver <span style=color:#f92672>=</span> webdriver<span style=color:#f92672>.</span>Remote(
    command_executor<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;http://www.example.com&#39;</span>,
    seleniumwire_options<span style=color:#f92672>=</span>options
)
</code></pre></div><h5 id=访问请求>访问请求</h5>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python>driver<span style=color:#f92672>.</span>requests  <span style=color:#75715e># 按时间顺序排列的捕获请求列表</span>
driver<span style=color:#f92672>.</span>last_request  <span style=color:#75715e># 最近捕获的请求, driver.requests[-1]</span>
</code></pre></div><p>等待匹配的请求返回</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#75715e># pat 是一个正则表达式，返回找到的第一个请求</span>
<span style=color:#75715e># 未在指定时间返回，引发异常 TimeoutException</span>
driver<span style=color:#f92672>.</span>wait_for_request(pat, timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)

<span style=color:#75715e># 点击页面后，等待返回 12345 接口</span>
button_element<span style=color:#f92672>.</span>click()
request <span style=color:#f92672>=</span> driver<span style=color:#f92672>.</span>wait_for_request(<span style=color:#e6db74>&#39;/api/products/12345/&#39;</span>)
</code></pre></div><p>将请求保存为 har 格式</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#75715e># 必须设置浏览器：enable_har=true</span>
driver<span style=color:#f92672>.</span>har

<span style=color:#75715e># 返回捕获请求的迭代器。在处理大量请求时很有用。</span>
driver<span style=color:#f92672>.</span>iter_requests()

<span style=color:#75715e># 用于设置请求拦截器。请参阅拦截请求和响应。</span>
driver<span style=color:#f92672>.</span>request_interceptor

<span style=color:#75715e># 用于设置响应拦截器。</span>
driver<span style=color:#f92672>.</span>response_interceptor

<span style=color:#75715e># 要清除以前捕获的请求和 HAR 条目，请使用del</span>
<span style=color:#66d9ef>del</span> driver<span style=color:#f92672>.</span>requests
</code></pre></div><p>Selenium Wire 默认忽略 OPTIONS 请求，因为这些通常是无趣的，只会增加开销。如果要捕获 OPTIONS 请求，则需要将<code>ignore_http_methods</code>
<a href=https://github.com/wkeeling/selenium-wire#all-options title=选项 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
选项
<i class="fa fa-external-link-alt"></i>
</a>设置为<code>[]</code>.</p>
<h2 id=请求对象>请求对象</h2>
<p>请求对象具有以下属性。</p>
<ul>
<li>
<p><code>body</code></p>
<p>请求正文为<code>bytes</code>. 如果请求没有正文，则 的值为<code>body</code>空，即<code>b''</code>.</p>
</li>
<li>
<p><code>cert</code></p>
<p>字典格式的有关服务器 SSL 证书的信息。对于非 HTTPS 请求为空。</p>
</li>
<li>
<p><code>date</code></p>
<p>发出请求的日期时间。</p>
</li>
<li>
<p><code>headers</code></p>
<p>请求标头的类似字典的对象。标头不区分大小写，并且允许重复。请求<code>request.headers['user-agent']</code>将返回<code>User-Agent</code>标头的值。如果您希望替换标题，请确保先使用 删除现有标题<code>del request.headers['header-name']</code>，否则您将创建一个副本。</p>
</li>
<li>
<p><code>host</code></p>
<p>请求主机，例如<code>www.example.com</code></p>
</li>
<li>
<p><code>method</code></p>
<p>HTTP 方法，例如<code>GET</code>或<code>POST</code>等。</p>
</li>
<li>
<p><code>params</code></p>
<p>请求参数字典。如果同名参数在请求中多次出现，它在字典中的值将是一个列表。</p>
</li>
<li>
<p><code>path</code></p>
<p>请求路径，例如<code>/some/path/index.html</code></p>
</li>
<li>
<p><code>querystring</code></p>
<p>查询字符串，例如<code>foo=bar&spam=eggs</code></p>
</li>
<li>
<p><code>response</code></p>
<p>与请求关联的
<a href=https://github.com/wkeeling/selenium-wire#response-objects title=响应对象。 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
响应对象。
<i class="fa fa-external-link-alt"></i>
</a><code>None</code>如果请求没有响应，就会出现这种情况。</p>
</li>
<li>
<p><code>url</code></p>
<p>请求网址，例如<code>https://www.example.com/some/path/index.html?foo=bar&spam=eggs</code></p>
</li>
<li>
<p><code>ws_messages</code></p>
<p>如果请求是 websocket 握手请求（通常以 URL 开头<code>wss://</code>），<code>ws_messages</code>则将包含发送和接收的所有 websocket 消息的列表。请参阅
<a href=https://github.com/wkeeling/selenium-wire#websocketmessage-objects title="WebSocketMessage 对象" rel="noopener external nofollow noreferrer" target=_blank class=exturl>
WebSocketMessage 对象
<i class="fa fa-external-link-alt"></i>
</a>。</p>
</li>
</ul>
<p>请求对象具有以下方法。</p>
<ul>
<li>
<p><code>abort(error_code=403)</code></p>
<p>使用提供的错误代码触发立即终止请求。在请求拦截器中使用。请参阅
<a href=https://github.com/wkeeling/selenium-wire#example-block-a-request title=示例：阻止请求 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
示例：阻止请求
<i class="fa fa-external-link-alt"></i>
</a>。</p>
</li>
<li>
<p><code>create_response(status_code, headers=(), body=b'')</code></p>
<p>创建一个响应并返回它而不向远程服务器发送任何数据。在请求拦截器中使用。请参阅
<a href=https://github.com/wkeeling/selenium-wire#example-mock-a-response title=示例：模拟响应 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
示例：模拟响应
<i class="fa fa-external-link-alt"></i>
</a>。</p>
</li>
</ul>
<h3 id=websocketmessage-对象>WebSocketMessage 对象</h3>
<p>这些对象表示在浏览器和服务器之间发送的 websocket 消息，反之亦然。它们由<code>request.ws_messages</code>websocket 握手请求保存在列表中。它们具有以下属性。</p>
<ul>
<li>
<p><code>content</code></p>
<p>消息内容可以是<code>str</code>或<code>bytes</code>。</p>
</li>
<li>
<p><code>date</code></p>
<p>消息的日期时间。</p>
</li>
<li>
<p><code>from_client</code></p>
<p><code>True</code>消息何时由客户端发送以及<code>False</code>何时由服务器发送。</p>
</li>
</ul>
<h2 id=响应对象>响应对象</h2>
<p>响应对象具有以下属性。</p>
<ul>
<li>
<p><code>body</code></p>
<p>响应主体为<code>bytes</code>. 如果响应没有正文，则 的值为<code>body</code>空，即<code>b''</code>。有时正文可能已被服务器压缩。<code>disable_encoding</code>
<a href=https://github.com/wkeeling/selenium-wire#all-options title=您可以使用选项 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
您可以使用选项
<i class="fa fa-external-link-alt"></i>
</a>来防止这种情况。要手动解码编码的响应主体，您可以执行以下操作：</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>from seleniumwire.utils import decode

body = decode(response.body, response.headers.get(&#39;Content-Encoding&#39;, &#39;identity&#39;))
</code></pre></div><ul>
<li>
<p><code>date</code></p>
<p>收到响应的日期时间。</p>
</li>
<li>
<p><code>headers</code></p>
<p>类似字典的响应标头对象。标头不区分大小写，并且允许重复。请求<code>response.headers['content-length']</code>将返回<code>Content-Length</code>标头的值。如果您希望替换标题，请确保先使用 删除现有标题<code>del response.headers['header-name']</code>，否则您将创建一个副本。</p>
</li>
<li>
<p><code>reason</code></p>
<p>原因短语，例如<code>OK</code>或<code>Not Found</code>等。</p>
</li>
<li>
<p><code>status_code</code></p>
<p>响应的状态代码，例如<code>200</code>或<code>404</code>等。</p>
</li>
</ul>
<h2 id=拦截请求和响应>拦截请求和响应</h2>
<p>除了捕获请求和响应，Selenium Wire 还允许您使用拦截器动态修改它们。拦截器是一个函数，在请求和响应通过 Selenium Wire 时被调用。在拦截器中，您可以根据需要修改请求和响应。</p>
<p><code>driver.request_interceptor</code>在开始使用驱动程序之前，您可以使用和<code>driver.response_interceptor</code>属性设置拦截器函数。请求拦截器应该接受请求的单个参数。响应拦截器应该接受两个参数，一个用于原始请求，一个用于响应。</p>
<h3 id=示例添加请求头>示例：添加请求头</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;New-Header&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Some Value&#39;</span>

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># All requests will now contain New-Header</span>
</code></pre></div><p>如何检查标头是否已正确设置？您可以在页面加载后使用 打印捕获的请求的标头<code>driver.requests</code>，或者将网络驱动程序指向https://httpbin.org/headers，这会将请求标头回显给浏览器，以便您可以查看它们。</p>
<h3 id=示例替换现有请求标头>示例：替换现有请求标头</h3>
<p>HTTP 请求中允许重复的标头名称，因此在设置替换标头之前，您必须先使用<code>del</code>以下示例中的 like 删除现有标头，否则将存在两个具有相同名称的标头（<code>request.headers</code>是一个特殊的类字典对象，允许重复).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    <span style=color:#66d9ef>del</span> request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Referer&#39;</span>]  <span style=color:#75715e># Remember to delete the header first</span>
    request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Referer&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;some_referer&#39;</span>  <span style=color:#75715e># Spoof the referer</span>

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># All requests will now use &#39;some_referer&#39; for the referer</span>
</code></pre></div><h3 id=示例添加响应标头>示例：添加响应标头</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request, response):  <span style=color:#75715e># A response interceptor takes two args</span>
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>url <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;https://server.com/some/path&#39;</span>:
        response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;New-Header&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Some Value&#39;</span>

driver<span style=color:#f92672>.</span>response_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># Responses from https://server.com/some/path will now contain New-Header</span>
</code></pre></div><h3 id=示例添加请求参数>示例：添加请求参数</h3>
<p>请求参数与标头的工作方式不同，因为它们是在请求中设置时计算的。这意味着您首先必须读取它们，然后更新它们，然后再将它们写回——就像下面的例子一样。参数保存在常规字典中，因此具有相同名称的参数将被覆盖。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    params <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>params
    params[<span style=color:#e6db74>&#39;foo&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;bar&#39;</span>
    request<span style=color:#f92672>.</span>params <span style=color:#f92672>=</span> params

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># foo=bar will be added to all requests</span>
</code></pre></div><h3 id=示例更新-post-请求正文中的-json>示例：更新 POST 请求正文中的 JSON</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#f92672>import</span> json

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;POST&#39;</span> <span style=color:#f92672>and</span> request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Content-Type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;application/json&#39;</span>:
        <span style=color:#75715e># The body is in bytes so convert to a string</span>
        body <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>body<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
        <span style=color:#75715e># Load the JSON</span>
        data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(body)
        <span style=color:#75715e># Add a new property</span>
        data[<span style=color:#e6db74>&#39;foo&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;bar&#39;</span>
        <span style=color:#75715e># Set the JSON back on the request</span>
        request<span style=color:#f92672>.</span>body <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
        <span style=color:#75715e># Update the content length</span>
        <span style=color:#66d9ef>del</span> request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Content-Length&#39;</span>]
        request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Content-Length&#39;</span>] <span style=color:#f92672>=</span> str(len(request<span style=color:#f92672>.</span>body))

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)
</code></pre></div><h3 id=示例基本身份验证>示例：基本身份验证</h3>
<p>如果站点需要用户名/密码，您可以使用请求拦截器为每个请求添加身份验证凭据。这将阻止浏览器显示用户名/密码弹出窗口。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#f92672>import</span> base64

auth <span style=color:#f92672>=</span> (
    base64<span style=color:#f92672>.</span>encodebytes(<span style=color:#e6db74>&#39;my_username:my_password&#39;</span><span style=color:#f92672>.</span>encode())
    <span style=color:#f92672>.</span>decode()
    <span style=color:#f92672>.</span>strip()
)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>host <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;host_that_needs_auth&#39;</span>:
        request<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;Authorization&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Basic </span><span style=color:#e6db74>{</span>auth<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># Credentials will be transmitted with every request to &#34;host_that_needs_auth&#34;</span>
</code></pre></div><h3 id=示例阻止请求>示例：阻止请求</h3>
<p>您可以使用它<code>request.abort()</code>来阻止请求并将立即响应发送回浏览器。可以提供可选的错误代码。默认值为 403（禁止）。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    <span style=color:#75715e># Block PNG, JPEG and GIF images</span>
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>endswith((<span style=color:#e6db74>&#39;.png&#39;</span>, <span style=color:#e6db74>&#39;.jpg&#39;</span>, <span style=color:#e6db74>&#39;.gif&#39;</span>)):
        request<span style=color:#f92672>.</span>abort()

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># Requests for PNG, JPEG and GIF images will result in a 403 Forbidden</span>
</code></pre></div><h3 id=示例模拟响应>示例：模拟响应</h3>
<p>您可以使用<code>request.create_response()</code>将自定义回复发送回浏览器。不会向远程服务器发送任何数据。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>interceptor</span>(request):
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>url <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;https://server.com/some/path&#39;</span>:
        request<span style=color:#f92672>.</span>create_response(
            status_code<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>,
            headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;Content-Type&#39;</span>: <span style=color:#e6db74>&#39;text/html&#39;</span>},  <span style=color:#75715e># Optional headers dictionary</span>
            body<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&lt;html&gt;Hello World!&lt;/html&gt;&#39;</span>  <span style=color:#75715e># Optional body</span>
        )

driver<span style=color:#f92672>.</span>request_interceptor <span style=color:#f92672>=</span> interceptor
driver<span style=color:#f92672>.</span>get(<span style=color:#f92672>...</span>)

<span style=color:#75715e># Requests to https://server.com/some/path will have their responses mocked</span>
</code></pre></div><p><em>您还有其他您认为有用的示例吗？欢迎提交 PR。</em></p>
<h3 id=取消设置拦截器>取消设置拦截器</h3>
<p>要取消设置拦截器，请使用<code>del</code>：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>del driver.request_interceptor
del driver.response_interceptor
</code></pre></div><h2 id=限制请求捕获>限制请求捕获</h2>
<p>Selenium Wire 的工作原理是通过它在后台启动的内部代理服务器重定向浏览器流量。当请求流经代理时，它们会被拦截和捕获。捕获请求可以稍微减慢速度，但您可以采取一些措施来限制捕获的内容。</p>
<ul>
<li>
<p><code>driver.scopes</code></p>
<p>这接受将匹配要捕获的 URL 的正则表达式列表。它应该在发出任何请求之前在驱动程序上设置。当为空（默认）时，将捕获所有 URL。<code>driver.scopes = [ '.*stackoverflow.*', '.*github.*' ] driver.get(...) # Start making requests # Only request URLs containing "stackoverflow" or "github" will now be captured</code>请注意，即使请求超出范围且未被捕获，它仍将通过 Selenium Wire 传输。</p>
</li>
<li>
<p><code>seleniumwire_options.disable_capture</code></p>
<p>使用此选项关闭请求捕获。请求仍将通过 Selenium Wire 和您配置的任何上游代理传递，但不会被拦截或存储。请求拦截器不会执行。<code>options = { 'disable_capture': True # Don't intercept/store any requests } driver = webdriver.Chrome(seleniumwire_options=options)</code></p>
</li>
<li>
<p><code>seleniumwire_options.exclude_hosts</code></p>
<p>使用此选项可以完全绕过 Selenium Wire。对此处列出的地址发出的任何请求都将直接从浏览器发送到服务器，而不涉及 Selenium Wire。请注意，如果您配置了上游代理，那么这些请求也将绕过该代理。<code>options = { 'exclude_hosts': ['host1.com', 'host2.com'] # Bypass Selenium Wire for these hosts } driver = webdriver.Chrome(seleniumwire_options=options)</code></p>
</li>
<li>
<p><code>request.abort()</code></p>
<p>
<a href=https://github.com/wkeeling/selenium-wire#intercepting-requests-and-responses title=您可以通过在请求拦截器 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
您可以通过在请求拦截器
<i class="fa fa-external-link-alt"></i>
</a>中使用<code>request.abort()</code>from 来提前中止请求。这将立即向客户端发送响应，而无需进一步传输请求。您可以使用此机制来阻止某些类型的请求（例如图像）以提高页面加载性能。<code>def interceptor(request): # Block PNG, JPEG and GIF images if request.path.endswith(('.png', '.jpg', '.gif')): request.abort() driver.request_interceptor = interceptor driver.get(...) # Start making requests</code></p>
</li>
</ul>
<h2 id=请求存储>请求存储</h2>
<p>默认情况下，捕获的请求和响应存储在系统临时文件夹（<code>/tmp</code>在 Linux 上，通常<code>C:\Users\&lt;username>\AppData\Local\Temp</code>在 Windows 上）中名为<code>.seleniumwire</code>. 要更改<code>.seleniumwire</code>文件夹的创建位置，您可以使用以下<code>request_storage_base_dir</code>选项：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage_base_dir&#39;: &#39;/my/storage/folder&#39;  # .seleniumwire will get created here
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><h3 id=内存存储>内存存储</h3>
<p>Selenium Wire 还支持仅在内存中存储请求和响应，这在某些情况下可能很有用 - 例如，如果您运行的是短期 Docker 容器并且不希望磁盘持久性的开销。<code>request_storage</code>您可以通过将选项设置为启用内存存储<code>memory</code>：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage&#39;: &#39;memory&#39;  # Store requests and responses in memory only
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><p>如果您担心可能消耗的内存量，您可以限制使用该<code>request_storage_max_size</code>选项存储的请求数：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage&#39;: &#39;memory&#39;,
    &#39;request_storage_max_size&#39;: 100  # Store no more than 100 requests in memory
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><p>当达到最大大小时，旧请求将在新请求到达时被丢弃。<code>driver.requests</code>请记住，如果您限制存储的请求数量，当您使用或<code>driver.wait_for_request()</code>等检索它们时，请求可能已经从存储中消失。</p>
<h2 id=代理>代理</h2>
<p>如果您正在访问的站点位于代理服务器后面，您可以在传递给网络驱动程序的选项中告诉 Selenium Wire 有关该代理服务器的信息。</p>
<p>配置采用以下格式：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;proxy&#39;: {
        &#39;http&#39;: &#39;http://192.168.10.100:8888&#39;,
        &#39;https&#39;: &#39;https://192.168.10.100:8888&#39;,
        &#39;no_proxy&#39;: &#39;localhost,127.0.0.1&#39;
    }
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><p>要将 HTTP Basic Auth 与您的代理一起使用，请在 URL 中指定用户名和密码：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;proxy&#39;: {
        &#39;https&#39;: &#39;https://user:pass@192.168.10.100:8888&#39;,
    }
}
</code></pre></div><p>对于 Basic 以外的身份验证，您可以<code>Proxy-Authorization</code>使用该<code>custom_authorization</code>选项为标头提供完整值。例如，如果您的代理使用 Bearer 方案：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;proxy&#39;: {
        &#39;https&#39;: &#39;https://192.168.10.100:8888&#39;,  # No username or password used
        &#39;custom_authorization&#39;: &#39;Bearer mytoken123&#39;  # Custom Proxy-Authorization header value
    }
}
</code></pre></div><p><code>Proxy-Authorization</code>可以在
<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Proxy-Authorization title=此处 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
此处
<i class="fa fa-external-link-alt"></i>
</a>找到有关标头的更多信息。</p>
<p>代理配置也可以通过名为<code>HTTP_PROXY</code>,<code>HTTPS_PROXY</code>和的环境变量加载<code>NO_PROXY</code>：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>$ export HTTP_PROXY=&#34;http://192.168.10.100:8888&#34;
$ export HTTPS_PROXY=&#34;https://192.168.10.100:8888&#34;
$ export NO_PROXY=&#34;localhost,127.0.0.1&#34;
</code></pre></div><h3 id=socket>Socket</h3>
<p>使用 SOCKS 代理与使用基于 HTTP 的代理相同，但您将方案设置为<code>socks5</code>：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;proxy&#39;: {
        &#39;http&#39;: &#39;socks5://user:pass@192.168.10.100:8888&#39;,
        &#39;https&#39;: &#39;socks5://user:pass@192.168.10.100:8888&#39;,
        &#39;no_proxy&#39;: &#39;localhost,127.0.0.1&#39;
    }
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><p>如果您的代理不需要身份验证，您可以省略<code>user</code>和。<code>pass</code></p>
<p>以及<code>socks5</code>，计划<code>socks4</code>和<code>socks5h</code>支持。<code>socks5h</code>当您希望 DNS 解析发生在代理服务器而不是客户端时使用。</p>
<p><strong>将 Selenium Wire 与 Tor 结合使用</strong></p>
<p>如果您想使用 Tor 运行 Selenium Wire，请参阅
<a href=https://gist.github.com/woswos/38b921f0b82de009c12c6494db3f50c5 title=此示例。 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
此示例。
<i class="fa fa-external-link-alt"></i>
</a></p>
<h3 id=动态切换>动态切换</h3>
<p>如果要更改现有驱动程序实例的代理设置，请使用<code>driver.proxy</code>属性：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>driver.get(...)  # Using some initial proxy

# Change the proxy
driver.proxy = {
    &#39;https&#39;: &#39;https://user:pass@192.168.10.100:8888&#39;,
}

driver.get(...)  # These requests will use the new proxy
</code></pre></div><p>要清除代理，请设置<code>driver.proxy</code>为空 dict <code>{}</code>。</p>
<p>该机制还支持<code>no_proxy</code>和<code>custom_authorization</code>选项。</p>
<h2 id=机器人检测>机器人检测</h2>
<p>如果 Selenium Wire 在您的环境中找到它，它将与
<a href=https://github.com/ultrafunkamsterdam/undetected-chromedriver title=undetected-chromedriver集成。 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
undetected-chromedriver集成。
<i class="fa fa-external-link-alt"></i>
</a>该库将透明地修改 ChromeDriver 以防止其在网站上触发反机器人措施。</p>
<p>如果你想利用这一点，请确保你已经安装了 undetected_chromedriver：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>pip install undetected-chromedriver
</code></pre></div><p>然后在您的代码中，导入<code>seleniumwire.undetected_chromedriver</code>包：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>import seleniumwire.undetected_chromedriver as uc

chrome_options = uc.ChromeOptions()

driver = uc.Chrome(
    options=chrome_options,
    seleniumwire_options={}
)
</code></pre></div><h2 id=证书>证书</h2>
<p>Selenium Wire 使用它自己的根证书来解密 HTTPS 流量。浏览器通常不需要信任此证书，因为 Selenium Wire 告诉浏览器将其添加为例外。这将允许浏览器正常运行，但它会在地址栏中显示“不安全”消息（和/或解锁的挂锁）。如果您希望摆脱此消息，您可以手动安装根证书。</p>
<p>
<a href=https://github.com/wkeeling/selenium-wire/raw/master/seleniumwire/ca.crt title=您可以在此处 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
您可以在此处
<i class="fa fa-external-link-alt"></i>
</a>下载根证书。下载后，导航到浏览器设置中的“证书”，然后在“权限”部分导入证书。</p>
<h3 id=使用您自己的证书>使用您自己的证书</h3>
<p>如果您想使用自己的根证书，您可以使用<code>ca_cert</code>和<code>ca_key</code>选项提供证书路径和私钥。</p>
<p>如果您确实指定了自己的证书，请务必手动删除 Selenium Wire 的
<a href=https://github.com/wkeeling/selenium-wire#request-storage title=临时存储文件夹 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
临时存储文件夹
<i class="fa fa-external-link-alt"></i>
</a>。这将清除可能从以前的运行中缓存的任何现有证书。</p>
<h2 id=所有选项>所有选项</h2>
<p>可以通过<code>seleniumwire_options</code>webdriver 属性传递给 Selenium Wire 的所有选项的摘要。</p>
<ul>
<li>
<p><code>addr</code></p>
<p>运行 Selenium Wire 的机器的 IP 地址或主机名。这默认为 127.0.0.1。如果您使用的是
<a href=https://github.com/wkeeling/selenium-wire#creating-the-webdriver title="远程 webdriver" rel="noopener external nofollow noreferrer" target=_blank class=exturl>
远程 webdriver
<i class="fa fa-external-link-alt"></i>
</a> ，您可能希望将其更改为机器（或容器）的公共 IP 。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;addr&#39;: &#39;192.168.0.10&#39;  # Use the public IP of the machine
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>auto_config</code></p>
<p>Selenium Wire 是否应该为请求捕获自动配置浏览器。<code>True</code>默认。</p>
</li>
<li>
<p><code>ca_cert</code></p>
<p>如果您更喜欢使用自己的证书而不是使用默认证书，则为根 (CA) 证书的路径。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;ca_cert&#39;: &#39;/path/to/ca.crt&#39;  # Use own root certificate
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>ca_key</code></p>
<p>如果您使用自己的根证书，则为私钥的路径。使用您自己的证书时，必须始终提供密钥。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;ca_key&#39;: &#39;/path/to/ca.key&#39;  # Path to private key
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>disable_capture</code></p>
<p>禁用请求捕获。当<code>True</code>没有任何内容被拦截或存储时。<code>False</code>默认。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;disable_capture&#39;: True  # Don&#39;t intercept/store any requests.
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>disable_encoding</code></p>
<p>要求服务器发回未压缩的数据。<code>False</code>默认。当<code>True</code>这将<code>Accept-Encoding</code>标头设置<code>identity</code>为所有出站请求时。请注意，它并不总是有效 - 有时服务器可能会忽略它。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;disable_encoding&#39;: True  # Ask the server not to compress the response
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>enable_har</code></p>
<p>当<code>True</code>保留 HTTP 事务的 HAR 存档时，可以使用<code>driver.har</code>. <code>False</code>默认。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;enable_har&#39;: True  # Capture HAR data, retrieve with driver.har
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>exclude_hosts</code></p>
<p>应完全绕过 Selenium Wire 的地址列表。请注意，如果您配置了上游代理，那么对排除的主机的请求也将绕过该代理。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;exclude_hosts&#39;: [&#39;google-analytics.com&#39;]  # Bypass these hosts
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>ignore_http_methods</code></p>
<p>Selenium Wire 应忽略且不捕获的 HTTP 方法列表（指定为大写字符串）。默认是<code>['OPTIONS']</code>忽略所有 OPTIONS 请求。要捕获所有请求方法，请设置<code>ignore_http_methods</code>为空列表：</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;ignore_http_methods&#39;: []  # Capture all requests, including OPTIONS requests
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>port</code></p>
<p>Selenium Wire 后端监听的端口号。您通常不需要指定端口，因为系统会自动选择随机端口号。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;port&#39;: 9999  # Tell the backend to listen on port 9999 (not normally necessary to set this)
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>proxy</code></p>
<p>如果您使用代理，则为上游
<a href=https://github.com/wkeeling/selenium-wire#proxies title=代理服务器配置。 rel="noopener external nofollow noreferrer" target=_blank class=exturl>
代理服务器配置。
<i class="fa fa-external-link-alt"></i>
</a></p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;proxy&#39;: {
        &#39;http&#39;: &#39;http://user:pass@192.168.10.100:8888&#39;,
        &#39;https&#39;: &#39;https://user:pass@192.168.10.100:8889&#39;,
        &#39;no_proxy&#39;: &#39;localhost,127.0.0.1&#39;
    }
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>request_storage</code></p>
<p>要使用的存储类型。Selenium Wire 默认为基于磁盘的存储，但您可以通过将此选项设置为以下来切换到内存存储<code>memory</code>：</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage&#39;: &#39;memory&#39;  # Store requests and responses in memory only
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>request_storage_base_dir</code></p>
<p>Selenium Wire 在使用其默认的基于磁盘的存储时存储捕获的请求和响应的基本位置。这默认为系统临时文件夹（<code>/tmp</code>在 Linux 上，通常<code>C:\Users\&lt;username>\AppData\Local\Temp</code>在 Windows 上）。将在此处创建一个名为的子文件夹<code>.seleniumwire</code>来存储捕获的数据。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage_base_dir&#39;: &#39;/my/storage/folder&#39;  # .seleniumwire will get created here
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>request_storage_max_size</code></p>
<p>使用内存存储时要存储的最大请求数。默认无限制。使用默认的基于磁盘的存储时，此选项当前无效。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;request_storage&#39;: &#39;memory&#39;,
    &#39;request_storage_max_size&#39;: 100  # Store no more than 100 requests in memory
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>suppress_connection_errors</code></p>
<p>是否抑制与连接相关的回溯。<code>True</code>默认情况下，这意味着有时在浏览器关闭时发生的无害错误不会提醒用户。当被抑制时，连接错误消息被记录在 DEBUG 级别，没有回溯。设置为<code>False</code>允许异常传播并查看完整的回溯。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;suppress_connection_errors&#39;: False  # Show full tracebacks for any connection errors
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div><ul>
<li>
<p><code>verify_ssl</code></p>
<p>是否应验证 SSL 证书。<code>False</code>默认情况下，这可以防止自签名证书出错。</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>options = {
    &#39;verify_ssl&#39;: True  # Verify SSL certificates but beware of errors with self-signed certificates
}
driver = webdriver.Chrome(seleniumwire_options=options)
</code></pre></div>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/selenium>
Selenium
</a>
</div>
<div class=addthis_inline_share_toolbox style=text-align:center></div>
<hr>
<div class=reward-container>
<div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div>
<button>赞赏</button>
<div class=post-reward>
<div class=post-reward-item>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.jpg alt="ABEE - 支付宝">
<span>支付宝</span>
</div>
<div class=post-reward-item>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.jpg alt="ABEE - 微信">
<span>微信</span>
</div>
</div>
</div>
<div class=post-nav>
<div class="post-nav-next post-nav-item">
<a href=/tech/docker/docker-compose%E6%8A%A5%E9%94%99%E6%B1%87%E6%80%BB/ rel=next title="Docker - Docker Compose报错汇总">
<i class="fa fa-chevron-left"></i> Docker - Docker Compose报错汇总
</a>
</div>
<div class="post-nav-prev post-nav-item">
<a href=/tech/selenium/chromedriver/ rel=prev title="Selenium - Chromedriver">
Selenium - Chromedriver
<i class="fa fa-chevron-right"></i>
</a>
</div>
</div>
</footer>
</article>
</div>
<div id=comments class=post-comments>
<div class=comment-head>
<div class=comment-headline>
<i class="fas fa-comments fa-fw"></i>
<span>评论交流</span>
</div>
</div>
<div class=comment-wrap>
<div><div class=comment-loading>
<i class="fa fa-sync fa-spin"></i>
</div><div class=giscus-container></div>
</div>
</div>
</div>
</div>
</main>
<footer class=footer>
<div class=footer-inner>
<div class=copyright>
&copy;
<span itemprop=copyrightYear>
2023
</span>
<span class=with-love>
<i class="fa fa-heart"></i>
</span>
<span class=author itemprop=copyrightHolder>ABEE</span>
</div>
</div>
</footer>
<script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#336699","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":"DIC_kwDOJaSA684CW2kC","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"abeelan/abeelan.github.io","repoid":"R_kgDOJaSA6w","theme":"light_tritanopia"},"js":"https://giscus.app/client.js"},"hostname":"https://abeelan.github.io","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1"}</script>
<script type=text/javascript src=/js/main.min.1d9b2de404f7724da1d867644752be389255e13dcf22ec8a95e590c4546881e9.js defer></script>
</body>
</html>